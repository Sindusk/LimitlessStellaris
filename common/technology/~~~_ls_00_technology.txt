##########################################################################
# Limitless Stellaris - Technology
##########################################################################

##################################################
## Vanilla
##################################################

## Arcane Deciphering
# Merge between EMEX, Spaceborne Civs Expanded, STU
tech_arcane_deciphering = {
	cost = @tier2cost3
	area = society
	tier = 2
	category = { archaeostudies }
	prerequisites = { tech_society_2 }
	weight = @tier2weight3
	is_rare = yes

	feature_flags = {
		unlock_arcane_deciphering
	}

	weight_modifier = {
		factor = 0.50
		modifier = {
			factor = 0
			NOT = {
				has_resource = { type = minor_artifacts amount > 0 }
			}
		}
		modifier = {
			factor = 0
			has_ancrel = no
		}
		modifier = {
			factor = 2
			has_trait_in_council = { TRAIT = leader_trait_expertise_statecraft }
		}
		modifier = { # EMEX
			factor = 2.5
			OR = {
				has_valid_civic = civic_antique_purveyors_ancrel
				has_valid_civic = civic_antique_appropriators_ancrel
			}
		}
	}
}

## Archeology Lab
# Merge between EMEX, Spaceborne Civs Expanded, STU
tech_archeology_lab_ancrel = {
	area = society
	category = { archaeostudies }
	tier = 2
	cost = @tier2cost1
	is_reverse_engineerable = no
	is_rare = yes
	weight = @tier2weight1
	icon = "tech_archeology_lab"

	modifier = {
		ship_archaeological_site_clues_add = 2
		ship_anomaly_research_speed_mult = 0.25 # Spaceborne Civs Expanded
	}

	weight_modifier = {
		modifier = { # EMEX
			factor = 2.5
			OR = {
				has_valid_civic = civic_antique_purveyors_ancrel
				has_valid_civic = civic_antique_appropriators_ancrel
			}
		}
		modifier = {
			factor = 0.50
			has_modifier = "curator_insight"
		}
		modifier = {
			factor = @ap_technological_ascendancy_rare_tech
			has_ascension_perk = ap_technological_ascendancy
		}
		modifier = {
			factor = @federation_perk_factor
			has_federation = yes
			federation = {
				has_federation_perk = rare_tech_boost
				any_member = { has_technology = tech_archeology_lab_ancrel }
			}
		}
		modifier = {
			factor = 3
			has_trait_in_council = { TRAIT = leader_trait_curator }
		}
		modifier = {
			factor = 0
			NOR = {
				has_trait_in_council = { TRAIT = leader_trait_curator }
				has_modifier = "curator_insight"
			}
		}
	}

	prereqfor_desc = {
		component = {
			title = "TECH_UNLOCK_CURATOR_LAB_2_TITLE"
			desc = "TECH_UNLOCK_CURATOR_LAB_2_DESC"
		}
	}

	potential = {
		has_ancrel = yes
	}
}

## Assembly Pattern
# Merge between Planetary Decision Build Speed, Bug Branch, Ariphaos
tech_assembly_pattern = {
	cost = @tier1cost3
	area = engineering
	tier = 1
	category = { industry }
	prerequisites = { "tech_engineering_1" }
	weight = @tier1weight3

	modifier = {
		planet_building_build_speed_mult = 0.25
		planet_decision_enact_speed_mult = 0.25 # Planetary Decision Build Speed
	}

	weight_modifier = {

		modifier = {
			factor = 1.25
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
			}
		}
		modifier = { # Bug Branch
			factor = 1.25
			is_bugged_functional_architecture = yes
		}
	}

	ai_weight = {

	}
}

## Construction Templates
# Merge between Planetary Decision Build Speed, Bug Branch, Ariphaos, STU
tech_construction_templates = {
	cost = @tier3cost2
	area = engineering
	tier = 3
	is_rare = yes
	category = { industry }
	prerequisites = { "tech_assembly_pattern" }
	weight = @tier3weight2

	modifier = {
		planet_building_build_speed_mult = 0.50
		planet_decision_enact_speed_mult = 0.50 # Planetary Decision Build Speed
		empire_size_districts_mult = -0.10
		show_only_custom_tooltip = no
		custom_tooltip = tech_construction_templates_effect
	}

	weight_modifier = {
		factor = 0.5
		modifier = {
			factor = 0.5
			NOR = {
				has_trait_in_council = { TRAIT = leader_trait_expertise_industry }
				has_trait_in_council = { TRAIT = leader_trait_curator }
			}
		}
		modifier = {
			factor = @ap_technological_ascendancy_rare_tech
			has_ascension_perk = ap_technological_ascendancy
		}
		modifier = {
			factor = @federation_perk_factor
			has_federation = yes
			federation = {
				has_federation_perk = rare_tech_boost
				any_member = { has_technology = tech_construction_templates }
			}
		}
		modifier = {
			factor = 1.25
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
			}
		}
		modifier = { # Bug Branch
			factor = 1.25
			is_bugged_functional_architecture = yes
		}
	}

	ai_weight = {

	}
}

## Droid Workers
# Merge between Bug Branch, EMEX, Ariphaos, STU
tech_droid_workers = {
	cost = @tier2cost3
	area = engineering
	tier = 2
	category = { industry }
	prerequisites = { "tech_robotic_workers" "tech_colonial_centralization" }
	weight = @tier2weight3

	gateway = robotics

	feature_flags = { droids }

	weight_modifier = {
		modifier = {
			factor = 0
			has_policy_flag = robots_outlawed
		}
		modifier = {
			factor = 0.5
			OR = {
				has_ethic = "ethic_spiritualist"
				has_ethic = "ethic_fanatic_spiritualist"
			}
			is_bugged_machine_cult = no # Bug Branch
		}
		modifier = {
			factor = 2
			OR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_materialist
			}
		}
		modifier = {
			factor = 2
			has_origin = origin_mechanists
		}

		modifier = { # Bug Branch
			factor = 2
			is_bugged_machine_cult = yes
		}
		modifier = { # EMEX
			factor = 10
			is_machine_cult_emex = yes
		}
	}

	ai_weight = {
		factor = @robots_ai_tech_factor
		modifier = {
			factor = 2
			OR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_materialist
			}
		}
		modifier = {
			factor = 0
			NOR = {
				has_ai_personality_behaviour = robot_exploiter
				has_ai_personality_behaviour = robot_liberator
			}
		}
		modifier = {
			factor = 2
			has_origin = origin_mechanists
		}

	}
}

## Housing 2
# Merge between Bug Branch, Masters of Nature, Ariphaos, STU
tech_housing_2 = {
	cost = @tier3cost1
	area = engineering
	tier = 3
	category = { industry }
	prerequisites = { "tech_housing_1" }
	weight = @tier3weight1

	modifier = {
		description = district_housing_tech_effect
    }
    
    prereqfor_desc = {
		custom = {
			title = "sky_island_unlock"
			desc = "sky_island_effect"
		}
	}

	weight_modifier = {
		factor = 1.5
		modifier = {
			factor = 0
			is_bugged_agrarian_idyll = yes # Bug Branch
		}
		modifier = {
			factor = 1.25
			is_bugged_functional_architecture = yes
		}

	}

	ai_weight = {

		modifier = {
			factor = @housing_ai_tech_factor
			num_pops >= 100
		}
	}
}

## Housing Agrarian Idyll
# Merge between Bug Branch, Subtle Polish, Ariphaos, STU
tech_housing_agrarian_idyll = {
	cost = @tier3cost1
	area = society
	tier = 3
	category = { statecraft }
	weight = @tier3weight1

	modifier = {
		description = district_housing_agrarian_idyll_tech_effect
	}

	weight_modifier = {
		factor = 1.5
		modifier = {
			factor = 0
			OR = {
				NOT = { is_bugged_agrarian_idyll = yes }
				is_lithoid_empire = yes
			}
		}

	}

	ai_weight = {
		
		modifier = {
			factor = @housing_ai_tech_factor
			num_pops >= 100
		}
	}
}

## Psionic Theory
# Merge between Bug Branch, NGS, Expanded Gestalts, Extra Origins, Ariphaos, STU
tech_psionic_theory = {
	cost = @tier3cost1
	area = society
	tier = 3
	category = { psionics }
	is_rare = yes
	weight = @tier3weight1
	is_reverse_engineerable = no

	gateway = psionics

	potential = {
		OR = { #The OR is so that Gestalts can get Zro Distillation with that Resolution
			is_machine_empire = no # LS gestalt -> machine (why not hives?)
			is_active_resolution = resolution_galacticstudies_extradimensional_experimentation
			is_active_resolution = "resolution_galacticstudies_6" # NGS
			has_relic = r_zro_crystal
		}
	}

	modifier = {
		empire_size_pops_mult = -0.10
	}

	weight_modifier = {
		factor = 0.5
		modifier = {
			factor = 0
			is_gestalt = yes # Merged
		}
		modifier = {
			factor = 0.5
			is_spiritualist = no
		}
		modifier = {
			factor = 2
			has_ethic = "ethic_fanatic_spiritualist"
		}
		modifier = { # Bug Branch
			factor = 2
			has_valid_civic = civic_bugged_esper_agency_corpo
		}
		modifier = {
			factor = 2
			OR = {
				has_trait_in_council = { TRAIT = leader_trait_maniacal }
				has_trait_in_council = { TRAIT = leader_trait_maniacal_2 }
				has_trait_in_council = { TRAIT = leader_trait_maniacal_3 }
			}
		}
		modifier = {
			factor = 2
			OR = {
				has_trait_in_council = { TRAIT = leader_trait_psionic }
				has_trait_in_council = { TRAIT = leader_trait_chosen }
				has_trait_in_council = { TRAIT = leader_trait_composer_chosen }
				has_trait_in_council = { TRAIT = leader_trait_instrument_chosen }
				has_trait_in_council = { TRAIT = leader_trait_whisperers_chosen }
			}
		}
		modifier = {
			factor = @ap_technological_ascendancy_rare_tech
			has_ascension_perk = ap_technological_ascendancy
		}
		modifier = {
			factor = @federation_perk_factor
			has_federation = yes
			federation = {
				has_federation_perk = rare_tech_boost
				any_member = { has_technology = tech_psionic_theory }
			}
		}
		modifier = {
			factor = 2
			any_owned_pop = {
				pop_has_trait = trait_psionic
			}
		}
		modifier = {
			factor = 1.25
			any_owned_pop = {
				pop_has_trait = trait_latent_psionic
			}
			NOT = {
				any_owned_pop = {
					pop_has_trait = trait_psionic
				}
			}
		}
		modifier = {
			factor = 2
			any_owned_planet = {
				has_modifier = pm_shroudwalker_teacher
			}
		}
		modifier = {
			factor = 0
			AND = {
				is_materialist = yes
				NOR = {
					has_trait_in_council = { TRAIT = leader_trait_expertise_psionics }
					any_owned_pop = {
						OR = {
							pop_has_trait = trait_psionic
							pop_has_trait = trait_latent_psionic
						}
					}
					has_valid_civic = civic_bugged_esper_agency_corpo # Bug Branch
				}
			}
		}
	}

	ai_weight = {
		modifier = {
			factor = 5
			OR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
			}
		}

		modifier = {
			factor = 2
			is_ai = no #auto-research
		}
	}
}
