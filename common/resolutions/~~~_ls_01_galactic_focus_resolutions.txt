##########################################################################
# Limitless Stellaris - Resolutions
##########################################################################

##################################################
## Galactic Focus
##################################################

## Galactic Focus - Crisis: Contingency
# Merge between EED, MECR, StarTech, Ariphaos
resolution_galactic_focus_crisis_contingency = {
	icon = "GFX_resolution_emergency_measure"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t1
		}
	}
	target = no

	modifier = {
		resolution_end_game = 1 # EED
	}

	effect = {
		custom_tooltip = resolution_galactic_focus_crisis_contingency_effect_success

		hidden_effect = {
			repeal_all_galactic_focus_resolutions = yes
			set_global_flag = galactic_focus_crisis_contingency
			set_global_flag = galactic_community_crisis_fighting

			set_global_flag = galactic_community_resolution_passed

			set_timed_country_flag = { flag = galactic_community_resolution_passed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_passed_diplomatic_weight
				days = 2200
			}
		}
	}

	fail_effects = {
		hidden_effect = {
			set_timed_country_flag = { flag = galactic_community_resolution_failed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_failed_diplomatic_weight
				days = 2200
			}
		}
	}

	potential = {
		has_global_flag = ai_invasion_ongoing
		NOT = { has_global_flag = galactic_focus_crisis_contingency }
		NOT = { has_global_flag = flag_imperial_crusade_ongoing } # MECR
	}

	active = { # Resolution only in effect while this trigger is met
		has_global_flag = ai_invasion_ongoing
	}

	ai_weight = {
		base = @resolution_weight_normal
		
		modifier = { # EED
			factor = 10
			has_modifier = prepared_for_the_end
			desc = ap_defender_of_the_galaxy
		}

		modifier = {
			factor = 2 # StarTech 10 -> 2

			any_neighbor_country = {
				is_country_type = ai_empire
			}
			desc = gal_com_neighboring_ai_empire
		}
		
		modifier = { # EED
			factor = 10
			any_relation = {
				is_in_federation_with = prev
				any_neighbor_country = {
					is_country_type = ai_empire
				}
			}
			desc = gal_com_neighboring_ai_empire
		}
		
		modifier = { # EED
			factor = 2
			any_relation = {
				has_defensive_pact = prev
				any_neighbor_country = {
					is_country_type = ai_empire
				}
			}
			desc = gal_com_neighboring_ai_empire
		}
		
		modifier = { # EED
			factor = 0.75
			any_relation = {
				is_rival = prev
				any_neighbor_country = {
					is_country_type = ai_empire
				}
			}
			NOT = {
				any_neighbor_country = {
					is_country_type = ai_empire
				}
			}
			desc = gal_com_rival_is_neighboring_ai_empire
		}

		modifier = {
			factor = 0.75

			NOT = {
				any_neighbor_country = {
					is_country_type = ai_empire
				}
			}
			desc = gal_com_not_neighboring_ai_empire
		}

		modifier = {
			factor = 0.75 # StarTech 0.5 -> 0.75

			has_crisis_stage_1 = yes
			desc = gal_com_crisis_stage_1
		}

		modifier = {
			factor = 1.25 # StarTech 4 -> 1.25

			has_crisis_stage_3 = yes
			desc = gal_com_crisis_stage_3
		}

		modifier = {
			factor = 10 # StarTech 20 -> 10

			has_crisis_stage_4 = yes
			desc = gal_com_crisis_stage_4
		}

		modifier = {
			factor = 50 # EED 10 -> 50

			has_ascension_perk = ap_defender_of_the_galaxy
			desc = ap_defender_of_the_galaxy
		}
		
		modifier = { # EED
			factor = 3
			OR = {
				has_valid_civic = civic_philosopher_king
				is_civic_diplomatic_corps = yes
			}
			desc = gal_com_supporting_civics
		}
		
		modifier = { # EED
			factor = 0
			OR = {
				has_ethic = ethic_fanatic_xenophobe
				is_inwards_perfection_empire = yes
				is_pompous_empire = yes
			}
			desc = ethic_fanatic_xenophobe
		}

		modifier = {
			factor = 1.2 # StarTech 1.5 -> 1.2
			is_militarist = yes
			desc = ethic_militarist
		}
		modifier = { # EED
			factor = 2
			has_ethic = ethic_fanatic_militarist
			desc = ethic_militarist
		}

		modifier = {
			factor = 1.1 # StarTech 1.5 -> 1.1
			is_xenophile = yes
			desc = ethic_xenophile
		}
		modifier = { # EED
			factor = 1.5
			has_ethic = ethic_fanatic_xenophile
			desc = ethic_xenophile
		}

		modifier = { # EED
			factor = 3
			is_materialist = yes
			desc = ethic_materialist
		}
		modifier = { # EED
			factor = 2
			has_origin = origin_shroud_pact
			desc = origin_shroud_pact
		}
		modifier = { # EED
			factor = 5
			is_synthetic_empire = yes
			desc = ap_synthetic_evolution
		}

		modifier = {
			factor = 1.2
			OR = {
				is_materialist = yes
				is_synthetic_empire = yes
			}
			desc = gal_com_is_materialist_or_synthetic
		}

		modifier = {
			factor = 0.5
			OR = { # EED
				is_xenophobe = yes
				is_xenophobic_isolationists = yes # EED
			}
			NOT = {
				any_neighbor_country = {
					is_country_type = ai_empire
				}
			}
			desc = ethic_xenophobe
		}
		
		modifier = { # EED
			factor = 5
			OR = {
				is_servitor_empire = yes
				is_open_gestalt = yes
			}
			desc = gal_com_supporting_civics
		}
		
		modifier = { # EED
			factor = 5
			is_gestalt = yes
			desc = ethic_gestalt_consciousness
		}
		
		modifier = { # EED
			factor = 5
			has_tradition = tr_psionics_psionic_assimilation
			desc = tr_psionics_psionic_assimilation
		}
		
		modifier = { # EED
			factor = 3
			desc = gal_com_councilor
			any_country = {
				is_part_of_galactic_council = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_contingency
			}
		}
		modifier = { # EED
			factor = 4
			desc = gal_com_custodian
			any_country = {
				is_galactic_custodian = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_contingency
			}
		}
		modifier = { # EED
			factor = 5
			desc = gal_com_emperor
			any_country = {
				is_galactic_emperor = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_contingency
			}
		}
		
		modifier = { # Ariphaos
			factor = 0.1
			has_ethic = ethic_fanatic_xenophobe

			NOT = {
				any_neighbor_country = {
					is_country_type = ai_empire
				}
			}
			desc = ethic_fanatic_xenophobe
		}
	}
}

## Galactic Focus - Crisis: Great Khan
# Merge between EED, MECR, StarTech, Ariphaos
resolution_galactic_focus_crisis_greatkhan = {
	icon = "GFX_resolution_emergency_measure"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t1
		}
	}
	target = no

	modifier = { # EED
		resolution_great_khan= 1
	}

	effect = {
		custom_tooltip = resolution_galactic_focus_crisis_greatkhan_effect_success

		hidden_effect = {
			repeal_all_galactic_focus_resolutions = yes
			set_global_flag = galactic_focus_crisis_greatkhan
			set_global_flag = galactic_community_crisis_fighting

			set_global_flag = galactic_community_resolution_passed

			set_timed_country_flag = { flag = galactic_community_resolution_passed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_passed_diplomatic_weight
				days = 2200
			}
		}
	}

	fail_effects = {
		hidden_effect = {
			set_timed_country_flag = { flag = galactic_community_resolution_failed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_failed_diplomatic_weight
				days = 2200
			}
		}
	}

	potential = {
		has_global_flag = great_khan_announcement
		NOT = { has_global_flag = great_khan_dead }
		NOT = { has_global_flag = galactic_focus_crisis_greatkhan }
		NOT = { has_global_flag = flag_imperial_crusade_ongoing } # MECR
	}

	active = { # Resolution only in effect while this trigger is met
		NOT = { has_global_flag = great_khan_dead }
	}

	ai_weight = {
		base = @resolution_weight_normal

		modifier = {
			factor = 0

			any_agreement = { agreement_preset = preset_satrapy }
			NOT = { has_country_flag = rebelling_satrapy }
			desc = gal_com_satrapy
		}

		modifier = {
			factor = 20 # EED 10 -> 20

			any_agreement = { agreement_preset = preset_satrapy }
			has_country_flag = rebelling_satrapy
			desc = gal_com_rebelling_satrapy
		}

		modifier = {
			factor = 2 # StarTech 4 -> 2

			any_neighbor_country = {
				is_country_type = awakened_marauders
			}

			desc = gal_com_neighboring_awakened_marauders
		}
		
		modifier = { # EED
			factor = 8
			any_relation = {
				is_in_federation_with = prev
				any_neighbor_country = {
					is_country_type = awakened_marauders
				}
			}
			desc = gal_com_neighboring_awakened_marauders
		}
		
		modifier = { # EED
			factor = 1.5
			any_relation = {
				has_defensive_pact = prev
				any_neighbor_country = {
					is_country_type = awakened_marauders
				}
			}
			desc = gal_com_neighboring_awakened_marauders
		}
		
		modifier = { # EED
			factor = 0.75
			any_relation = {
				is_rival = prev
				any_neighbor_country = {
					OR = {
						is_country_type = awakened_marauders
						AND = {
							any_agreement = { agreement_preset = preset_satrapy }
							NOT = { has_country_flag = rebelling_satrapy }
						}
					}
				}
			}
			NOT = {
				any_neighbor_country = {
					is_country_type = awakened_marauders
				}
			}
			desc = gal_com_rival_neighboring_awakened_marauders
		}

		modifier = {
			factor = 1.1 # StarTech 2 -> 1.1

			any_neighbor_country = {
				any_agreement = { agreement_preset = preset_satrapy }
				NOT = { has_country_flag = rebelling_satrapy }
				NOT = { is_rival = prev } # EED
			}
			desc = gal_com_neighboring_satrapy
		}
		
		modifier = { # EED
			factor = 3
			OR = {
				has_valid_civic = civic_philosopher_king
				is_civic_diplomatic_corps = yes
			}
			desc = gal_com_supporting_civics
		}
		
		modifier = { # EED
			factor = 0
			OR = {
				has_ethic = ethic_fanatic_xenophobe
				is_inwards_perfection_empire = yes
				is_pompous_empire = yes
			}
			desc = ethic_fanatic_xenophobe
		}

		modifier = {
			factor = 1.2
			is_militarist = yes
			desc = ethic_militarist
		}
		modifier = { # EED
			factor = 2
			has_ethic = ethic_fanatic_militarist
			desc = ethic_militarist
		}

		modifier = { # EED
			factor = 2
			is_xenophile = yes
			desc = ethic_xenophile
		}
		modifier = { # EED
			factor = 1.5
			has_ethic = ethic_fanatic_xenophile
			desc = ethic_xenophile
		}

		modifier = {
			factor = 2 # EED 1.2 -> 2
			is_pacifist = yes
			desc = ethic_pacifist
		}
		modifier = { # EED
			factor = 1.5
			has_ethic = ethic_fanatic_pacifist
			desc = ethic_pacifist
		}

		modifier = {
			factor = 0.5
			OR = { # EED
				is_xenophobe = yes
				is_xenophobic_isolationists = yes # EED
			}
			NOT = {
				any_neighbor_country = {
					OR = {
						is_country_type = awakened_marauders
						any_agreement = { agreement_preset = preset_satrapy }
					}
				}
			}
			desc = ethic_xenophobe
		}
		
		modifier = { # EED
			factor = 6
			OR = {
				is_servitor_empire = yes
				is_open_gestalt = yes
			}
			desc = gal_com_supporting_civics
		}
		
		modifier = { # EED
			factor = 3
			desc = gal_com_councilor
			any_country = {
				is_part_of_galactic_council = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_greatkhan
			}
		}
		modifier = { # EED
			factor = 4
			desc = gal_com_custodian
			any_country = {
				is_galactic_custodian = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_greatkhan
			}
		}
		modifier = { # EED
			factor = 5
			desc = gal_com_emperor
			any_country = {
				is_galactic_emperor = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_greatkhan
			}
		}
		
		modifier = { # Ariphaos
			factor = 0.1
			has_ethic = ethic_fanatic_xenophobe

			NOT = {
				any_neighbor_country = {
					OR = {
						is_country_type = awakened_marauders
						any_agreement = { agreement_preset = preset_satrapy }
					}
				}
			}
			desc = ethic_fanatic_xenophobe
		}
	}
}

## Galactic Focus - Crisis: Nanites
# Merge between EED, MECR, A Deadly Tempest, StarTech
resolution_galactic_focus_crisis_nanites = {
	icon = "GFX_resolution_emergency_measure"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t1
		}
	}
	target = no

	modifier = { # EED
		resolution_nanites= 1
	}

	effect = {
		custom_tooltip = resolution_galactic_focus_crisis_nanites_effect_success

		hidden_effect = {
			repeal_all_galactic_focus_resolutions = yes
			set_global_flag = galactic_focus_crisis_nanites
			set_global_flag = galactic_community_crisis_fighting

			set_global_flag = galactic_community_resolution_passed

			set_timed_country_flag = { flag = galactic_community_resolution_passed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_passed_diplomatic_weight
				days = 2200
			}
		}
	}

	fail_effects = {
		hidden_effect = {
			set_timed_country_flag = { flag = galactic_community_resolution_failed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_failed_diplomatic_weight
				days = 2200
			}
		}
	}

	potential = {
		has_global_flag = gray_goo_crisis_active
		NOT = { has_global_flag = galactic_focus_crisis_nanites }
		NOT = { has_global_flag = flag_imperial_crusade_ongoing } # MECR
	}

	active = { # Resolution only in effect while this trigger is met
		has_global_flag = gray_goo_crisis_active
	}

	ai_weight = {
		base = @resolution_weight_normal

		modifier = {
			factor = 10 # EED 2 -> 10
			any_neighbor_country = {
				is_country_type = gray_goo
			}
			desc = gal_com_neighboring_gray_goo
		}
		
		modifier = { # EED
			factor = 10
			any_relation = {
				is_in_federation_with = prev
				any_neighbor_country = {
					is_country_type = gray_goo
				}
			}
			desc = gal_com_neighboring_gray_goo
		}
		
		modifier = { # EED
			factor = 2
			any_relation = {
				has_defensive_pact = prev
				any_neighbor_country = {
					is_country_type = gray_goo
				}
			}
			desc = gal_com_neighboring_gray_goo
		}
		
		modifier = { # EED
			factor = 0.75
			any_relation = {
				is_rival = prev
				any_neighbor_country = {
					is_country_type = gray_goo
				}
			}
			NOT = {
				any_neighbor_country = {
					is_country_type = gray_goo
				}
			}
			desc = gal_com_rival_neighboring_gray_goo
		}

		modifier = {
			factor = 0.75

			NOT = {
				any_country = {
					is_country_type = gray_goo
					galaxy_percentage > 0.10
				}
			}
			desc = gal_com_gray_goo_size_smallest
		}

		modifier = {
			factor = 2 # EED 1.1 -> 2

			any_country = {
				is_country_type = gray_goo
				galaxy_percentage > 0.10
				galaxy_percentage <= 0.20
			}
			desc = gal_com_gray_goo_size_small
		}

		modifier = {
			factor = 5 # EED 1.5 -> 5

			any_country = {
				is_country_type = gray_goo
				galaxy_percentage > 0.20
				galaxy_percentage <= 0.30
			}
			desc = gal_com_gray_goo_size_medium
		}

		modifier = {
			factor = 10 # EED 2 -> 10

			any_country = {
				is_country_type = gray_goo
				galaxy_percentage > 0.30
				galaxy_percentage <= 0.40
			}
			desc = gal_com_gray_goo_size_large
		}

		modifier = {
			factor = 20 # EED 3 -> 20

			any_country = {
				is_country_type = gray_goo
				galaxy_percentage > 0.40
				galaxy_percentage <= 0.50
			}
			desc = gal_com_gray_goo_size_very_large
		}

		modifier = {
			factor = 30 # EED 10 -> 30

			any_country = {
				is_country_type = gray_goo
				galaxy_percentage > 0.50
			}
			desc = gal_com_gray_goo_size_huge
		}

		modifier = {
			factor = 50 # EED 10 -> 50

			has_ascension_perk = ap_defender_of_the_galaxy
			desc = ap_defender_of_the_galaxy
		}
		
		modifier = { # EED
			factor = 3
			OR = {
				has_valid_civic = civic_philosopher_king
				is_civic_diplomatic_corps = yes
			}
			desc = gal_com_supporting_civics
		}
		
		modifier = { # EED
			factor = 0
			OR = {
				has_ethic = ethic_fanatic_xenophobe
				is_inwards_perfection_empire = yes
				is_pompous_empire = yes
			}
			desc = ethic_fanatic_xenophobe
		}
		
		modifier = { # EED
			factor = 5
			is_synthetic_empire = yes
			desc = ap_synthetic_evolution
		}

		modifier = {
			factor = 1.2
			is_militarist = yes
			desc = ethic_militarist
		}
		modifier = { # EED
			factor = 2
			has_ethic = ethic_fanatic_militarist
			desc = ethic_militarist
		}

		modifier = {
			factor = 1.2
			is_materialist = yes
			desc = ethic_materialist
		}
		modifier = { # EED
			factor = 2
			has_origin = origin_shroud_pact
			desc = origin_shroud_pact
		}

		modifier = { # EED
			factor = 2
			is_xenophile = yes
			desc = ethic_xenophile
		}
		modifier = { # EED
			factor = 1.5
			has_ethic = ethic_fanatic_xenophile
			desc = ethic_xenophile
		}
		
		modifier = { # EED
			factor = 0.75
			has_ethic = ethic_fanatic_pacifist
			desc = ethic_pacifist
			NOT = {
				any_neighbor_country = {
					is_country_type = gray_goo
				}
			}
		}

		modifier = {
			factor = 0.5
			OR = { # EED
				is_xenophobe = yes
				is_xenophobic_isolationists = yes # EED
			}

			NOT = {
				any_neighbor_country = {
					is_country_type = gray_goo
				}
			}
			desc = ethic_xenophobe
		}
		
		modifier = { # EED
			factor = 5
			OR = {
				is_servitor_empire = yes
				is_open_gestalt = yes
			}
			desc = gal_com_supporting_civics
		}
		
		modifier = { # EED
			factor = 3
			desc = gal_com_councilor
			any_country = {
				is_part_of_galactic_council = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_nanites
			}
		}
		modifier = { # EED
			factor = 4
			desc = gal_com_custodian
			any_country = {
				is_galactic_custodian = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_nanites
			}
		}
		modifier = { # EED
			factor = 5
			desc = gal_com_emperor
			any_country = {
				is_galactic_emperor = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_nanites
			}
		}
		modifier = { # ADT
			factor = 0.5
			is_xenophobe = yes
			NOR = {
				# any_neighbor_country = { is_same_empire = event_target:graygoo_country }
				has_country_flag = nanite_bomb_affected
				event_target:graygoo_country = {
					num_killed_ships = {
						target = prev
						value > 15
					}
				}
				event_target:graygoo_country = {
					any_owned_fleet = {
						exists = solar_system
						solar_system = {
							NOT = { has_star_flag = lcluster }
							any_neighbor_system = {
								has_owner = yes
								is_owned_by = prevprevprevprev
							}
						}
					}
				}
			}
			desc = ethic_xenophobe
		}
	}
}

## Galactic Focus - Crisis: Prethoryn
# Merge between EED, MECR, StarTech, Ariphaos
resolution_galactic_focus_crisis_prethoryn = {
	icon = "GFX_resolution_emergency_measure"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t1
		}
	}
	target = no

	modifier = { # EED
		resolution_end_game = 1
	}

	effect = {
		custom_tooltip = resolution_galactic_focus_crisis_prethoryn_effect_success

		hidden_effect = {
			repeal_all_galactic_focus_resolutions = yes
			set_global_flag = galactic_focus_crisis_prethoryn
			set_global_flag = galactic_community_crisis_fighting

			set_global_flag = galactic_community_resolution_passed

			set_timed_country_flag = { flag = galactic_community_resolution_passed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_passed_diplomatic_weight
				days = 2200
			}
		}
	}

	fail_effects = {
		hidden_effect = {
			set_timed_country_flag = { flag = galactic_community_resolution_failed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_failed_diplomatic_weight
				days = 2200
			}
		}
	}

	potential = {
		has_global_flag = ongoing_prethoryn_invasion
		NOT = { has_global_flag = galactic_focus_crisis_prethoryn }
		NOT = { has_global_flag = flag_imperial_crusade_ongoing } # MECR
	}

	active = { # Resolution only in effect while this trigger is met
		has_global_flag = ongoing_prethoryn_invasion
	}

	ai_weight = {
		base = @resolution_weight_normal
		
		modifier = { # EED
			factor = 10
			has_modifier = prepared_for_the_end
			desc = ap_defender_of_the_galaxy
		}

		modifier = {
			factor = 2 # StarTech 10 -> 2

			any_neighbor_country = {
				is_country_type = swarm
			}
			desc = gal_com_is_neighboring_swarm
		}
		
		modifier = { # EED
			factor = 10
			any_relation = {
				is_in_federation_with = prev
				any_neighbor_country = {
					is_country_type = swarm
				}
			}
			desc = gal_com_is_neighboring_swarm
		}
		
		modifier = { # EED
			factor = 2
			any_relation = {
				has_defensive_pact = prev
				any_neighbor_country = {
					is_country_type = swarm
				}
			}
			desc = gal_com_is_neighboring_swarm
		}
		
		modifier = { # EED
			factor = 0.75
			any_relation = {
				is_rival = prev
				any_neighbor_country = {
					is_country_type = swarm
				}
			}
			NOT = {
				any_neighbor_country = {
					is_country_type = swarm
				}
			}
			desc = gal_com_rival_is_neighboring_swarm
		}

		modifier = {
			factor = 0.75

			NOT = {
				any_neighbor_country = {
					is_country_type = swarm
				}
			}
			desc = gal_com_is_not_neighboring_swarm
		}

		modifier = {
			factor = 0.75 # StarTech 0.5 -> 0.75

			has_crisis_stage_1 = yes
			desc = gal_com_crisis_stage_1
		}

		modifier = {
			factor = 1.25 # StarTech 4 -> 1.25

			has_crisis_stage_3 = yes
			desc = gal_com_crisis_stage_3
		}

		modifier = {
			factor = 10 # StarTech 20 -> 10

			has_crisis_stage_4 = yes
			desc = gal_com_crisis_stage_4
		}

		modifier = {
			factor = 10

			has_ascension_perk = ap_defender_of_the_galaxy
			desc = ap_defender_of_the_galaxy
		}
		
		modifier = { # EED
			factor = 3
			OR = {
				has_valid_civic = civic_philosopher_king
				is_civic_diplomatic_corps = yes
			}
			desc = gal_com_supporting_civics
		}
		
		modifier = { # EED
			factor = 0
			OR = {
				has_ethic = ethic_fanatic_xenophobe
				is_inwards_perfection_empire = yes
				is_pompous_empire = yes
			}
			desc = ethic_fanatic_xenophobe
		}

		modifier = {
			factor = 1.2 # StarTech 1.5 -> 1.2
			is_militarist = yes
			desc = ethic_militarist
		}
		modifier = { # EED
			factor = 2
			has_ethic = ethic_fanatic_militarist
			desc = ethic_militarist
		}

		modifier = {
			factor = 1.1 # StarTech 1.5 -> 1.1
			is_xenophile = yes
			desc = ethic_xenophile
		}
		modifier = { # EED
			factor = 1.5
			has_ethic = ethic_fanatic_xenophile
			desc = ethic_xenophile
		}

		modifier = {
			factor = 0.5
			is_xenophobe = yes

			NOT = {
				any_neighbor_country = {
					is_country_type = swarm
				}
			}
			desc = ethic_xenophobe
		}
		
		modifier = { # Ariphaos
			factor = 0.1
			OR = { # EED
				is_xenophobe = yes
				is_xenophobic_isolationists = yes # EED
			}

			NOT = {
				any_neighbor_country = {
					is_country_type = swarm
				}
			}
			desc = ethic_xenophobe
		}
		
		modifier = { # EED
			factor = 5
			OR = {
				is_servitor_empire = yes
				is_open_gestalt = yes
			}
			desc = gal_com_supporting_civics
		}
		
		modifier = { # EED
			factor = 3
			desc = gal_com_councilor
			any_country = {
				is_part_of_galactic_council = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_prethoryn
			}
		}
		modifier = { # EED
			factor = 4
			desc = gal_com_custodian
			any_country = {
				is_galactic_custodian = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_prethoryn
			}
		}
		modifier = { # EED
			factor = 5
			desc = gal_com_emperor
			any_country = {
				is_galactic_emperor = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_prethoryn
			}
		}
	}
}

## Galactic Focus - Crisis: Unbidden
# Merge between EED, MECR, StarTech, Ariphaos
resolution_galactic_focus_crisis_unbidden = {
	icon = "GFX_resolution_emergency_measure"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t1
		}
	}
	target = no

	modifier = { # EED
		resolution_end_game = 1
	}

	effect = {
		custom_tooltip = resolution_galactic_focus_crisis_unbidden_effect_success

		hidden_effect = {
			repeal_all_galactic_focus_resolutions = yes
			set_global_flag = galactic_focus_crisis_unbidden
			set_global_flag = galactic_community_crisis_fighting

			set_global_flag = galactic_community_resolution_passed

			set_timed_country_flag = { flag = galactic_community_resolution_passed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_passed_diplomatic_weight
				days = 2200
			}
		}
	}

	fail_effects = {
		hidden_effect = {
			set_timed_country_flag = { flag = galactic_community_resolution_failed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_failed_diplomatic_weight
				days = 2200
			}
		}
	}

	potential = {
		has_global_flag = extradimensional_invasion_happened
		NOR = {
			has_global_flag = extradimensional_invasion_defeated
			has_global_flag = galactic_focus_crisis_unbidden
		}
		NOT = { has_global_flag = flag_imperial_crusade_ongoing } # MECR
	}

	active = { # Resolution only in effect while this trigger is met
		NOT = { has_global_flag = extradimensional_invasion_defeated }
	}

	ai_weight = {
		base = @resolution_weight_normal
		
		modifier = { # EED
			factor = 10
			has_modifier = prepared_for_the_end
			desc = ap_defender_of_the_galaxy
		}

		modifier = {
			factor = 2 # StarTech 10 -> 2

			any_neighbor_country = {
				OR = {
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
				}
			}
			desc = gal_com_neighboring_extradimensional
		}
		
		modifier = { # EED
			factor = 10
			any_relation = {
				is_in_federation_with = prev
				any_neighbor_country = {
					OR = {
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					}
				}
			}
			desc = gal_com_neighboring_extradimensional
		}
		
		modifier = { # EED
			factor = 2
			any_relation = {
				has_defensive_pact = prev
				any_neighbor_country = {
					OR = {
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					}

				}
			}
			desc = gal_com_neighboring_extradimensional
		}
		
		modifier = { # EED
			factor = 0.75
			any_relation = {
				is_rival = prev
				any_neighbor_country = {
					OR = {
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					}

				}
			}
			NOT = {
				any_neighbor_country = {
					OR = {
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					}

				}
			}
			desc = gal_com_rival_is_neighboring_extradimensional
		}

		modifier = {
			factor = 0.75

			NOT = {
				any_neighbor_country = {
					OR = {
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					}
				}
			}
			desc = gal_com_not_neighboring_extradimensional
		}

		modifier = {
			factor = 0.75 # StarTech 0.5 -> 0.75

			has_crisis_stage_1 = yes
			desc = gal_com_crisis_stage_1
		}

		modifier = {
			factor = 1.25 # StarTech 4 -> 1.25

			has_crisis_stage_3 = yes
			desc = gal_com_crisis_stage_3
		}

		modifier = {
			factor = 10 # StarTech 20 -> 10

			has_crisis_stage_4 = yes
			desc = gal_com_crisis_stage_4
		}

		modifier = {
			factor = 50 # EED 10 -> 50

			has_ascension_perk = ap_defender_of_the_galaxy
			desc = ap_defender_of_the_galaxy
		}
		
		modifier = { # EED
			factor = 3
			OR = {
				has_valid_civic = civic_philosopher_king
				is_civic_diplomatic_corps = yes
			}
			desc = gal_com_supporting_civics
		}
		
		modifier = { # EED
			factor = 0
			OR = {
				has_ethic = ethic_fanatic_xenophobe
				is_inwards_perfection_empire = yes
				is_pompous_empire = yes
			}
			desc = ethic_fanatic_xenophobe
		}

		modifier = { # EED
			factor = 3
			
			is_militarist = yes
			desc = ethic_militarist
		}
		modifier = { # EED
			factor = 2
			has_ethic = ethic_fanatic_militarist
			desc = ethic_militarist
		}

		modifier = { # EED
			factor = 3
			is_xenophile = yes
			desc = ethic_xenophile
		}
		modifier = { # EED
			factor = 1.5
			has_ethic = ethic_fanatic_xenophile
			desc = ethic_xenophile
		}
		modifier = { # EED
			factor = 2
			is_spiritualist = yes
			desc = ethic_spiritualist
		}
		modifier = { # EED
			factor = 3
			has_ethic = ethic_fanatic_spiritualist
			desc = ethic_spiritualist
		}
		
		# machines and materialists don't understand the shroud very well
		modifier = { # EED
			factor = 0.5
			OR = {
				is_materialist = yes
				is_machine_empire = yes
			}
			NOT = { has_technology = tech_psionic_theory }
			NOT = { is_active_resolution = resolution_galacticstudies_extradimensional_experimentation }
			NOT = {
				any_neighbor_country = {
					OR = {
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					}
				}
			}
			desc = gal_com_shroud_skepticism
		}
		modifier = { # EED
			factor = 0.5
			OR = {
				has_ethic = ethic_fanatic_materialist
				is_civic_materialist = yes
			}
			NOT = { has_technology = tech_psionic_theory }
			NOT = { is_active_resolution = resolution_galacticstudies_extradimensional_experimentation }
			NOT = {
				any_neighbor_country = {
					OR = {
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					}
				}
			}
			desc = gal_com_shroud_skepticism
		}

		modifier = {
			factor = 1.2 # StarTech 1.5 -> 1.2
			is_militarist = yes
			desc = ethic_militarist
		}

		modifier = {
			factor = 1.1 # StarTech 1.5 -> 1.1
			is_xenophile = yes
			desc = ethic_xenophile
		}

		modifier = {
			factor = 1.1 # StarTech 1.5 -> 1.1
			is_spiritualist = yes
			desc = ethic_spiritualist
		}

		modifier = {
			factor = 0.5
			is_xenophobe = yes

			NOT = {
				any_neighbor_country = {
					OR = {
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					}
				}
			}
			desc = ethic_xenophobe
		}
		
		modifier = { # EED
			factor = 0.75
			has_ethic = ethic_fanatic_pacifist
			desc = ethic_pacifist
			NOT = {
				any_neighbor_country = {
					OR = {
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
					}
				}
			}
		}
		
		modifier = { # Ariphaos
			factor = 0.1
			OR = { # EED
				is_xenophobe = yes
				is_xenophobic_isolationists = yes # EED
			}

			NOT = {
				any_neighbor_country = {
					is_country_type = extradimensional
					is_country_type = extradimensional_2
					is_country_type = extradimensional_3
				}
			}
			desc = ethic_xenophobe
		}
		
		modifier = { # EED
			factor = 5
			OR = {
				is_servitor_empire = yes
				is_open_gestalt = yes
			}
			desc = gal_com_supporting_civics
		}
		
		modifier = { # EED
			factor = 10
			OR = {
				has_country_flag = breached_shroud
				has_origin = origin_shroud_pact
			}
			desc = gal_com_shroud_dangers
		}
		
		modifier = { # EED
			factor = 3
			desc = gal_com_councilor
			any_country = {
				is_part_of_galactic_council = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_unbidden
			}
		}
		modifier = { # EED
			factor = 4
			desc = gal_com_custodian
			any_country = {
				is_galactic_custodian = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_unbidden
			}
		}
		modifier = { # EED
			factor = 5
			desc = gal_com_emperor
			any_country = {
				is_galactic_emperor = yes
				is_proposing_resolution = resolution_galactic_focus_crisis_unbidden
			}
		}
	}
}

## Galactic Focus - War in Heaven (Denounce Both)
# Merge between EED, StarTech, Ariphaos
resolution_galactic_focus_war_in_heaven_denounce_both = {
	icon = "GFX_resolution_emergency_measure"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t1
		}
	}
	target = no

	triggered_modifier = {
		potential = {
			has_global_flag = war_in_heaven_ongoing
			OR = {
				NOT = { exists = overlord }
				overlord = {
					NOR = {
						is_same_value = event_target:FirstSleeper
						is_same_value = event_target:SecondSleeper
					}
				}
			}
		}
		modifier = {
			damage_vs_country_type_awakened_fallen_empire_mult = 0.25
		}
	}

	effect = {
		custom_tooltip = resolution_galactic_focus_war_in_heaven_denounce_both_success

		hidden_effect = {
			repeal_all_galactic_focus_resolutions = yes
			set_global_flag = galactic_focus_war_in_heaven
			set_global_flag = galactic_community_resolution_passed
			set_timed_country_flag = { flag = galactic_community_resolution_passed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_passed_diplomatic_weight
				days = 2200
			}
			if = { # EED
				limit = { event_target:FirstSleeper = { is_xenophile = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_xenoist days = 7200 }
			}
			if = { # EED
				limit = { event_target:FirstSleeper = { is_xenophobe = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_supremacist days = 7200 }
			}
			if = { # EED
				limit = { event_target:FirstSleeper = { is_materialist = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_technologist days = 7200 }
			}
			if = { # EED
				limit = { event_target:FirstSleeper = { is_spiritualist = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_traditionalist days = 7200 }
			}
			if = { # EED
				limit = { event_target:SecondSleeper = { is_xenophile = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_xenoist days = 7200 }
			}
			if = { # EED
				limit = { event_target:SecondSleeper = { is_xenophobe = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_supremacist days = 7200 }
			}
			if = { # EED
				limit = { event_target:SecondSleeper = { is_materialist = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_technologist days = 7200 }
			}
			if = { # EED
				limit = { event_target:SecondSleeper = { is_spiritualist = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_traditionalist days = 7200 }
			}
		}
	}

	fail_effects = {
		hidden_effect = {
			set_timed_country_flag = { flag = galactic_community_resolution_failed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_failed_diplomatic_weight
				days = 2200
			}
		}
	}

	potential = {
		has_global_flag = war_in_heaven_ongoing
		has_galactic_emperor = no # Empire always at war with WiH sides
		NOT = { has_global_flag = galactic_focus_war_in_heaven }
		exists = event_target:FirstSleeper
		exists = event_target:SecondSleeper
	}

	active = { # Resolution only in effect while this trigger is met
		has_global_flag = war_in_heaven_ongoing
	}

	breach = {
		has_global_flag = war_in_heaven_ongoing
		exists = overlord
		OR = {
			has_overlord = event_target:FirstSleeper
			has_overlord = event_target:SecondSleeper
		}
		NOT = { has_country_flag = constitutional_immunity }
	}

	ai_weight = {
		base = @resolution_weight_normal
		
		modifier = { # Ariphaos
			factor = 10
			has_federation = yes
			alliance = { has_federation_flag = non_aligned_league }
			desc = ariphaos_patch_gal_com_non_aligned_league
		}

		modifier = { # EED
			factor = 0
			exists = overlord
			OR = {
				has_overlord = event_target:FirstSleeper
				has_overlord = event_target:SecondSleeper
			}
			desc = gal_com_supporting_their_overlord
		}
		
		modifier = { # EED
			factor = 2
			OR = {
				NOT = { exists = overlord }
				NOR = {
					has_overlord = event_target:FirstSleeper
					has_overlord = event_target:SecondSleeper
				}
			}
			desc = gal_com_does_not_have_awakened_overlord
		}

		modifier = {
			factor = 0
			exists = overlord
			OR = {
				has_overlord = event_target:FirstSleeper
				has_overlord = event_target:SecondSleeper
			}
			desc = gal_com_does_not_have_awakened_overlord
		}
	}
}

## Galactic Focus - War in Heaven (Support Side 1)
# Merge between EED, MECR, StarTech, Ariphaos
resolution_galactic_focus_war_in_heaven_support_side_1 = {
	icon = "GFX_resolution_emergency_measure"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t1
		}
	}
	target = no

	effect = {
		custom_tooltip = resolution_galactic_focus_war_in_heaven_support_side_1_success

		hidden_effect = {
			repeal_all_galactic_focus_resolutions = yes
			set_global_flag = galactic_focus_war_in_heaven
			set_global_flag = galactic_community_resolution_passed
			set_timed_country_flag = { flag = galactic_community_resolution_passed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_passed_diplomatic_weight
				days = 2200
			}
			if = { # EED
				limit = { event_target:FirstSleeper = { is_xenophile = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_xenoist days = 7200 }
			}
			if = { # EED
				limit = { event_target:FirstSleeper = { is_xenophobe = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_supremacist days = 7200 }
			}
			if = { # EED
				limit = { event_target:FirstSleeper = { is_materialist = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_technologist days = 7200 }
			}
			if = { # EED
				limit = { event_target:FirstSleeper = { is_spiritualist = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_traditionalist days = 7200 }
			}
		}
	}

	fail_effects = {
		hidden_effect = {
			set_timed_country_flag = { flag = galactic_community_resolution_failed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_failed_diplomatic_weight
				days = 2200
			}
		}
	}

	potential = {
		has_global_flag = war_in_heaven_ongoing
		has_galactic_emperor = no # Empire always at war with WiH sides
		NOT = { has_global_flag = galactic_focus_war_in_heaven }
		exists = event_target:SecondSleeper
		NOT = { any_federation = { has_federation_perk = galactic_confederation_passive } } # MECR
	}

	active = { # Resolution only in effect while this trigger is met
		has_global_flag = war_in_heaven_ongoing
		exists = event_target:FirstSleeper
		exists = event_target:SecondSleeper
	}

	breach = {
		NAND = {
			exists = overlord
			has_overlord = event_target:FirstSleeper
		}
		NOT = { has_country_flag = constitutional_immunity }
	}

	ai_weight = {
		base = @resolution_weight_unpopular # Ariphaos normal -> unpopular

		modifier = {
			factor = 2 # StarTech 50 -> 2
			exists = overlord
			has_overlord = event_target:FirstSleeper
			desc = gal_com_supporting_their_overlord
		}
		
		modifier = { # EED
			factor = 0.5
			OR = {
				NOT = { exists = overlord }
				NOR = {
					has_overlord = event_target:FirstSleeper
					has_overlord = event_target:SecondSleeper
				}
			}
			desc = gal_com_does_not_have_awakened_overlord
		}

		modifier = { # Ariphaos
			factor = 0
			has_federation = yes
			alliance = { has_federation_flag = non_aligned_league }
			desc = ariphaos_patch_gal_com_non_aligned_league
		}

		modifier = {
			factor = 0
			exists = overlord
			NOT = { has_overlord = event_target:FirstSleeper }
			desc = gal_com_supporting_their_overlord
		}

		modifier = { # StarTech
			factor = 0
			exists = overlord
			has_overlord = event_target:SecondSleeper
			desc = gal_com_supporting_their_overlord
		}
	}
}

## Galactic Focus - War in Heaven (Support Side 2)
# Merge between EED, MECR, StarTech, Ariphaos
resolution_galactic_focus_war_in_heaven_support_side_2 = {
	icon = "GFX_resolution_emergency_measure"

	resources = {
		category = resolutions
		cost = {
			influence = @resolution_cost_t1
		}
	}
	target = no

	effect = {
		custom_tooltip = resolution_galactic_focus_war_in_heaven_support_side_2_success

		hidden_effect = {
			repeal_all_galactic_focus_resolutions = yes
			set_global_flag = galactic_focus_war_in_heaven
			set_global_flag = galactic_community_resolution_passed
			set_timed_country_flag = { flag = galactic_community_resolution_passed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_passed_diplomatic_weight
				days = 2200
			}
			if = { # EED
				limit = { event_target:SecondSleeper = { is_xenophile = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_xenoist days = 7200 }
			}
			if = { # EED
				limit = { event_target:SecondSleeper = { is_xenophobe = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_supremacist days = 7200 }
			}
			if = { # EED
				limit = { event_target:SecondSleeper = { is_materialist = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_technologist days = 7200 }
			}
			if = { # EED
				limit = { event_target:SecondSleeper = { is_spiritualist = yes } }
				set_timed_country_flag = { flag = galcom_resolution_passed_anti_traditionalist days = 7200 }
			}
		}
	}

	fail_effects = {
		hidden_effect = {
			set_timed_country_flag = { flag = galactic_community_resolution_failed_general days = @resolution_flag_timer }
			add_modifier = {
				modifier = resolution_failed_diplomatic_weight
				days = 2200
			}
		}
	}

	potential = {
		has_global_flag = war_in_heaven_ongoing
		has_galactic_emperor = no # Empire always at war with WiH sides
		NOT = { has_global_flag = galactic_focus_war_in_heaven }
		exists = event_target:FirstSleeper
		NOT = { any_federation = { has_federation_perk = galactic_confederation_passive } } # MECR
	}

	active = { # Resolution only in effect while this trigger is met
		has_global_flag = war_in_heaven_ongoing
		exists = event_target:FirstSleeper
		exists = event_target:SecondSleeper
	}

	breach = {
		NAND = {
			exists = overlord
			has_overlord = event_target:SecondSleeper
		}
		NOT = { has_country_flag = constitutional_immunity }
	}

	ai_weight = {
		base = @resolution_weight_unpopular # Ariphaos normal -> unpopular

		modifier = {
			factor = 0
			exists = overlord
			NOT = { has_overlord = event_target:SecondSleeper }
			desc = gal_com_supporting_their_overlord
		}

		modifier = { # StarTech AI
			factor = 0
			exists = overlord
			has_overlord = event_target:FirstSleeper
			desc = gal_com_supporting_their_overlord
		}
		
		modifier = { # EED
			factor = 0.5
			OR = {
				NOT = { exists = overlord }
				NOR = {
					has_overlord = event_target:FirstSleeper
					has_overlord = event_target:SecondSleeper
				}
			}
			desc = gal_com_does_not_have_awakened_overlord
		}

		modifier = {
			factor = 0
			has_federation = yes
			alliance = { has_federation_flag = non_aligned_league }
			desc = ariphaos_patch_gal_com_non_aligned_league
		}

		modifier = {
			factor = 2 # StarTech 50 -> 2
			exists = overlord
			has_overlord = event_target:SecondSleeper
			desc = gal_com_supporting_their_overlord
		}
	}
}
