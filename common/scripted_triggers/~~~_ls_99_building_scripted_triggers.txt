##########################################################################
# Limitless Stellaris - Building Scripted Triggers
##########################################################################

## Script for some generic building checks to ensure it's not being built on a specialized planet.
LS_generic_building_checks = {
	NOR = {
		has_modifier = resort_colony
		has_modifier = slave_colony
		has_modifier = crucible_colony
		has_planet_flag = planetary_station # Real Space: Planetary Stations
	}
}

##################################################
## Pop Assembly
##################################################

## Whether they can build a Clone Vats building
# Scope: Planet
LS_potential_clone_vats_building = {
	LS_generic_building_checks = yes # Generic Check
	exists = owner
	OR = { # Expanded Megastructures and Technology
		owner = { has_origin = origin_clones }
		owner = { is_clone_army_empire = yes }
		owner = { has_tradition = tr_genetics_adopt } # LS - Allow genetics adopters to use Clone Vats.
	}
	OR = { # StarTech AI
		owner = { is_ai = no }
		and = {
			free_building_slots > 0
			owner = { is_ai = yes num_pops < 1000 }
		}
	}
	OR = {
		owner = { is_ai = no }
		NOT = { exists = assembling_species }
		assembling_species = { is_organic_species = yes }
	}
	OR = {
		owner = { is_ai = no }
		NAND = {
			free_district_slots = 0
			free_building_slots <= 1
			free_housing <= 0
			free_jobs <= 0
		}
	}
}

## Determines if the Clone Vats building should be allowed to be constructed
# Scope: Planet
LS_allow_clone_vats_building = {
	custom_tooltip = {
		fail_text = "requires_not_basic_clone_army"
		exists = owner
		exists = planet
		OR = {
			owner = { NOT = { is_clone_army_empire = yes } }
			owner = { has_country_flag = clone_army_full_potential }
			owner = { has_country_flag = clone_army_fertility_unlocked }
			owner = { has_tradition = tr_genetics_adopt }
			planet = {
				any_owned_pop = {
					OR = {
						has_trait = trait_clone_soldier_infertile_full_potential
						has_trait = trait_clone_soldier_fertile
					}
				}
			}
		}
	}
}

## Determines if the Clone Vats building should be destroyed/converted.
# Scope: Planet
LS_destroy_clone_vats_building = {
	exists = owner
	exists = planet
	AND = {
		owner = { is_ai = yes }
		owner = { num_pops > 1000 } # StarTech
		free_district_slots = 0
		free_building_slots = 0
		free_housing <= 0
		free_jobs <= 0
	}
	NOR = {
		owner = { has_country_flag = clone_army_full_potential }
		owner = { has_country_flag = clone_army_fertility_unlocked }
		owner = { has_tradition = tr_genetics_adopt }
		planet = {
			any_owned_pop = {
				OR = {
					has_trait = trait_clone_soldier_infertile_full_potential
					has_trait = trait_clone_soldier_fertile
				}
			}
		}
	}
}

##################################################
## Resources
##################################################

## Whether they can build an Energy building
# Scope: Planet
LS_potential_energy_building = {
	LS_generic_building_checks = yes # Generic Check
	exists = owner
	OR = { # Habitats can only have energy building if they're gestalt or it is built over an energy deposit.
		is_habitat = no # Merged and inverted check
		AND = { # If they're a gestalt, the habitat doesn't need the flag.
			owner = { is_gestalt = yes }
		}
		has_planet_flag = energy_habitat # Non-gestalt on a habitat, it needs to be on an energy deposit.
	}
	OR = { # StarTech AI checks to ensure they are actually building energy here.
		owner = { is_ai = no }
		has_any_generator_district_or_building = yes
	}
}

## Whether they can build a Minerals building
# Scope: Planet
LS_potential_mineral_building = {
	LS_generic_building_checks = yes # Generic Check
	exists = owner
	NOR = { # Ringworlds don't have mines
		uses_district_set = ring_world # Undercoat: changed from planet class check
	}
	OR = { # Habitats only have mines if they're built on an appropriate deposit
		is_habitat = no
		has_planet_flag = mining_habitat
	}
	OR = { # StarTech check to ensure the AI has a mining district before they bother with these.
		owner = { is_ai = no }
		has_any_mining_district = yes
	}
}

## Whether they can build a Resource Silo building
# Scope: Planet
LS_potential_resource_silo_building = {
	LS_generic_building_checks = yes # Generic Check
}

##################################################
## Research
##################################################

# Whether they can build an Education Unique building
# Scope: Planet
LS_potential_education_building = {
	LS_generic_building_checks = yes # Generic Check
	exists = owner
	owner = {
		is_gestalt = no # Cannot be gestalt
		OR = { # Advancd Policies check
			has_policy_flag = AP_education_privledge_all
			has_policy_flag = AP_education_privledge_citizen
			has_policy_flag = AP_education_privledge_elite
		}
	}
}

# Whether they can build a Processing Unique building
# Scope: Planet
LS_potential_processing_building = {
	LS_generic_building_checks = yes # Generic Check
	exists = owner
	owner = {
		is_gestalt = yes # Must be gestalt
		OR = { # Advanced Policies check
			has_policy_flag = AP_instinctive_knowledge_all
			has_policy_flag = AP_instinctive_knowledge_most
			has_policy_flag = AP_instinctive_knowledge_some
			has_policy_flag = AP_instinctive_knowledge_few
			has_policy_flag = AP_instinctive_knowledge_none
		}
	}
}