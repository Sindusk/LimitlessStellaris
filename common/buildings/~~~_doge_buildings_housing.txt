####################################################################################################
# Doge Buildings - Housing
####################################################################################################

##################################################
## Luxury Residences (Tier 0, Foundation) [Vanilla] - Normal Empire, No Shared Burden civic
##################################################
building_luxury_residence = {
    base_buildtime = @db0_time #@b1_time
    category = amenity

	# Building Potential
    potential = {
        NOT = { has_modifier = slave_colony } # Cannot be built on a slave colony
        OR = { # Cannot be built on a habitat unless it's an advanced habitat.
            NOR = {
				is_planet_class = pc_habitat
				is_pd_habitat = yes
            }
            has_planet_flag = advanced_habitat
        }
        exists = owner
        owner = { # Cannot have Shared Burden civic
            is_regular_empire = yes
            NOT = { has_valid_civic = civic_shared_burden }
        }
    }
	# Allow Conditions
    allow = {
        buildings_simple_allow = yes
		# This whole thing is StarTech AI and reads like complete nonsense. We let the AI build it if it determines it should.
		#exists = owner
        #hidden_trigger = {
        #    OR = { # If it's an AI, another luxury residence must not already exist
        #        owner = { is_ai = no }
        #        NOT = { has_building = building_luxury_residence }
        #    }
        #    OR = { # If it's an AI, it must not be on the capital, have no research labs, and have 13 or more pops.
        #        owner = { is_ai = no }
        #        NOR = {
        #            is_capital = yes
        #            num_buildings = {
        #                type = building_research_lab_1
        #                value > 0
        #            }
        #            num_pops < 13
        #        }
        #    }
        #    OR = { # If it's an AI, there must be less than 1 luxury residence. Duplicate of the first condition?
        #        owner = { is_ai = no }
        #        num_buildings = {
        #            type = building_luxury_residence
        #            value < 1
        #        }
        #    }
        #    OR = { # If it's an AI, there must be at least 2 free jobs.
        #        owner = { is_ai = no }
        #        free_jobs > 2
        #    }
        #    OR = { # If it's an AI, there must be one of the following two conditions
        #        owner = { is_ai = no }
        #        AND = { # There is between -4 and -9 amenities, and have either 1) Less than 3 open district slots or 2) Between 12 and 15 pops total
        #            free_amenities < -4
        #            free_amenities > -9
        #            OR = {
        #                free_district_slots < 3
        #                num_pops < 16
        #                num_pops > 11
        #            }
        #        }
        #        AND = { # There is between -2 and -6 amenities, have more than 1 open free building slots, no free district slots, and have holo theatres building
        #            free_building_slots > 1
        #            free_amenities < -2
        #            free_amenities > -6
        #            free_district_slots = 0
        #            has_building = building_holo_theatres
        #        }
        #    }
        #}
    }
	# Destroy Trigger
    destroy_trigger = {
        exists = owner
        OR = {
            AND = { # Destroy if it's on a non-advanced habitat.
                is_planet_class = pc_habitat
                NOT = { has_planet_flag = advanced_habitat }
            }
            has_modifier = slave_colony # Cannot exist on a slave colony
            owner = { is_regular_empire = no } # Gestalt empires cannot have this building
            owner = { has_valid_civic = civic_shared_burden } # Shared Burden civic uses communal housing instead
            AND = { # Destroy if it's an AI and there's no free building slots left
                owner = { is_ai = yes }
                free_building_slots = 0
            }
			# This is all StarTech AI and reads like complete nonsense. We let the actual conditions for destruction dicatate it's removal.
            #AND = {
            #    free_building_slots = 0
            #    free_jobs < -2
            #    free_housing > 10
            #    free_district_slots = 0
            #    owner = {
            #        is_ai = yes
            #    }
            #}
            #and = {
            #    num_buildings = {
            #        type = building_research_lab_1
            #        value > 1
            #    }
            #    owner = {
            #        lategame = no
            #    }
            #    free_jobs < 1
            #    free_amenities > 6
            #    free_building_slots = 0
            #    owner = {
            #        is_ai = yes
            #    }
            #}
        }
    }
	
	# Building Conversions
    convert_to = {
        building_drone_storage
        building_hive_warren
        building_communal_housing
    }
	
	# Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db0_minerals #@b1_minerals
        }
        upkeep = {
            energy = @db0_upkeep #2
        }
    }

	# Permanent Planet Modifiers
    planet_modifier = {
        planet_housing_add = 3
        planet_amenities_add = 5
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_luxury_residence_tt
    }

	# Building Upgrades
    upgrades = {
        "building_planetary_shield_generator"
        "building_paradise_dome"
    }
}

##################################################
## Communal Housing (Tier 0, Foundation) [Vanilla] - Normal Empire, Shared Burden civic
##################################################
building_communal_housing = {
    base_buildtime = @db0_time #@b1_time
    icon = building_residence
    category = amenity

	# Building Potential
    potential = {
        NOT = { has_modifier = slave_colony } # Cannot be built on a slave colony
        OR = { # Cannot be built on a habitat unless it's an advanced habitat.
            NOR = {
				is_planet_class = pc_habitat
				is_pd_habitat = yes
            }
            has_planet_flag = advanced_habitat
        }
        exists = owner
        owner = { # Owner must have the Shared Burden civic
            is_regular_empire = yes
            has_valid_civic = civic_shared_burden
        }
    }
	# Allow Conditions
    allow = {
        buildings_simple_allow = yes
    }
	# Destroy Trigger
    destroy_trigger = {
        exists = owner
        OR = {
            AND = { # Destroy if it's on a non-advanced habitat.
                is_planet_class = pc_habitat
                NOT = { has_planet_flag = advanced_habitat }
            }
            has_modifier = slave_colony # Destroy it's on a slave colony.
            owner = { is_regular_empire = no } # Gestalt empires cannot have this building
            NOT = { owner = { has_valid_civic = civic_shared_burden } } # Empires without Shared Burden civic use Luxury Residence instead.
            AND = { # Destroy if it's an AI and there's no free building slots left
                owner = { is_ai = yes }
                free_building_slots = 0
            }
        }
    }
	
	# Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db0_minerals #@b1_minerals
        }
        upkeep = {
            energy = @db0_upkeep #2
        }
    }

	# Building Conversions
    convert_to = {
        building_drone_storage
        building_hive_warren
        building_luxury_residence
    }

	# Permanent Planet Modifiers
    planet_modifier = {
        planet_housing_add = 5
        planet_amenities_add = 3
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_communal_housing_tt
    }

	# Building Upgrades
    upgrades = {
        "building_planetary_shield_generator"
        "building_communal_housing_large"
    }
}

##################################################
## Drone Storage (Tier 0, Foundation) [Vanilla] - Machine Empire
##################################################
building_drone_storage = {
    base_buildtime = @b1_time
    category = amenity

	# Building Potential
    potential = {
        exists = owner
        owner = { is_machine_empire = yes }
    }
	# Allow Conditions
    allow = {
        buildings_simple_allow = yes
    }
	# Destroy Trigger
    destroy_trigger = {
        exists = owner
        OR = {
            owner = { is_machine_empire = no } # Destroy if not a machine empire
            AND = { # Destroy if it's an AI and there's no free building slots left
                owner = { is_ai = yes }
                free_building_slots = 0
            }
        }
    }
	
	# Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db0_minerals #@b1_minerals
        }
        upkeep = {
            energy = @db0_upkeep #2
        }
    }

	# Building Conversions
    convert_to = {
        building_luxury_residence
        building_communal_housing
        building_hive_warren
    }

	# Permanent Planet Modifier
    planet_modifier = {
        planet_housing_add = 4
        planet_amenities_add = 3
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_drone_storage_tt
    }
	
	# Building Upgrades
    upgrades = {
        "building_planetary_shield_generator"
        "building_drone_megastorage"
    }
}

##################################################
## Hive Warren (Tier 0, Foundation) [Vanilla] - Hive Mind
##################################################
building_hive_warren = {
    base_buildtime = @db0_time #@b1_time
    category = amenity

	# Building Potential
    potential = {
        exists = owner
        owner = { is_hive_empire = yes }
    }
	# Allow Conditions
    allow = {
        buildings_simple_allow = yes
    }
	# Destroy Trigger
    destroy_trigger = {
        exists = owner
        OR = {
			owner = { is_hive_empire = no } # Destroy if not a hive mind
            AND = { # Destroy if it's an AI and there's no free building slots left
                owner = { is_ai = yes }
                free_building_slots = 0
            }
        }
    }

	# Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db0_minerals #@b1_minerals
        }
        upkeep = {
            energy = @db0_upkeep #2
        }
    }

	# Building Conversions
    convert_to = {
        building_luxury_residence
        building_drone_storage
        building_communal_housing
    }
	# Permanent Planet Modifier
    planet_modifier = {
        planet_housing_add = 3
        planet_amenities_add = 5
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_hive_warren_tt
    }

	# Building Upgrades
    upgrades = {
        "building_planetary_shield_generator"
        "building_expanded_warren"
    }
}

##################################################
## Paradise Dome (Tier 2, Shelter) [Vanilla] - Normal Empire, Not Shared Burden
##################################################
building_paradise_dome = {
    base_buildtime = @db2_time #@b2_time
    can_build = no
    category = amenity

	# Building Potential
    potential = {
		exists = owner
        OR = { # Must be one of the following
            NOR = { # Not a habitat
				is_planet_class = pc_habitat
				is_pd_habitat = yes
            }
            AND = { # Advanced habitat with an owner who has Voidborn ascension perk
                has_planet_flag = advanced_habitat
                owner = { has_ascension_perk = ap_voidborn }
            }
        }
		is_regular_empire = yes
		NOT = { owner = { has_civic = civic_shared_burden } }
    }
	# Tech Prereqs
    prerequisites = {
        "tech_paradise_dome"
    }
    show_tech_unlock_if = {
		exists = owner
        owner = {
            is_regular_empire = yes
            NOT = { has_civic = civic_shared_burden }
        }
    }
	# Allow Conditions
    allow = {
        has_upgraded_capital = yes
    }
    # Destroy Trigger
    destroy_trigger = {
        exists = owner
        OR = {
            owner = { is_regular_empire = no }
            owner = { has_civic = civic_shared_burden }
            buildings_no_crystals = yes
            has_modifier = slave_colony
        }
    }
	
	# Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db2_minerals #@b2_minerals
            rare_crystals = @db2_rare_cost #@b2_rare_cost
        }
        upkeep = {
            energy = @db2_upkeep #3
            rare_crystals = @db2_rare_upkeep #@b2_rare_upkeep
        }
    }

	# Building Conversions
    convert_to = {
        building_organic_paradise
        building_drone_megastorage
        building_expanded_warren
        building_communal_housing_large
    }

	# Permanent Planet Modifiers
    planet_modifier = {
        planet_housing_add = 6
        planet_amenities_add = 10
    }

	# Additional housing and unity output from Keepers of Harmony civic [Civics & Ethics: Bug Branch]
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_bugged_keepers_of_harmony = yes }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.1
            planet_housing_add = 2
        }
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_paradise_dome_tt
    }

	# Building Upgrades
    upgrades = {
        "building_eutab_gaia_district"
    }

	# Building Flags for AI
    on_queued = {
        IF = {
            limit = {
                owner = { has_technology = tech_construction_templates }
            }
            owner = {
                set_timed_country_flag = {
                    flag = buildings_new_crystal_building
                    days = 270
                }
            }
        }
        ELSE_IF = {
            limit = {
                owner = { has_technology = tech_assembly_pattern }
            }
            owner = {
                set_timed_country_flag = {
                    flag = buildings_new_crystal_building
                    days = 390
                }
            }
        }
        else = {
            planet = {
                owner = {
                    set_timed_country_flag = {
                        flag = buildings_new_crystal_building
                        days = 510
                    }
                }
            }
        }
    }
}

##################################################
## Utopian Communal Housing (Tier 2, Shelter) [Vanilla] - Normal Empire, Shared Burden
##################################################
building_communal_housing_large = {
    base_buildtime = @db2_time #@b2_time
    can_build = no
    icon = building_paradise_dome
    category = amenity

	# Building Potential
    potential = {
		exists = owner
        OR = { # Must be one of the following
            NOR = { # Not a habitat
				is_planet_class = pc_habitat
				is_pd_habitat = yes
            }
            AND = { # Advanced habitat with an owner who has Voidborn ascension perk
                has_planet_flag = advanced_habitat
                owner = { has_ascension_perk = ap_voidborn }
            }
        }
		is_regular_empire = yes
		owner = { has_civic = civic_shared_burden }
    }
	# Tech Prereqs
    prerequisites = {
        "tech_paradise_dome"
    }
	# Allow Conditions
    allow = {
        has_upgraded_capital = yes
    }
    show_tech_unlock_if = {
        owner = {
            is_regular_empire = yes
            has_valid_civic = civic_shared_burden
        }
    }
	# Destroy Trigger
    destroy_trigger = {
        exists = owner
        OR = {
            owner = { is_regular_empire = no }
            NOT = { owner = { has_civic = civic_shared_burden } }
            has_modifier = slave_colony
            buildings_no_crystals = yes
        }
    }

	# Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db1_minerals #@b2_minerals
            rare_crystals = @b2_rare_cost
        }
        upkeep = {
            energy = 3
            rare_crystals = @b2_rare_upkeep
        }
    }

	# Building Conversions
    convert_to = {
        building_drone_megastorage
        building_expanded_warren
        building_paradise_dome
    }

	# Permanent Planet Modifiers
    planet_modifier = {
        planet_housing_add = 10
        planet_amenities_add = 6
    }

	# Additional housing and unity output from Keepers of Harmony civic [Civics & Ethics: Bug Branch]
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_bugged_keepers_of_harmony = yes }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.1
            planet_housing_add = 2
        }
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_communal_housing_large_tt
    }
	
	# Building Upgrades
    upgrades = {
        "building_eutab_gaia_district"
    }
}

##################################################
## Upgraded Drone Storage (Tier 2, Shelter) [Vanilla] - Machine Empire
##################################################
building_drone_megastorage = {
    base_buildtime = @db2_time #@b2_time
    can_build = no
    category = amenity

	# Building Potential
    potential = {
		exists = owner
        OR = { # Must be one of the following
            NOR = { # Not a habitat
				is_planet_class = pc_habitat
				is_pd_habitat = yes
            }
            AND = { # Advanced habitat with an owner who has Voidborn ascension perk
                has_planet_flag = advanced_habitat
                owner = { has_ascension_perk = ap_voidborn }
            }
        }
		is_machine_empire = yes
    }
	# Tech Prereqs
    prerequisites = {
        "tech_micro_replicators"
    }
	# Allow Conditions
    allow = {
        has_upgraded_capital = yes
    }
	# Destroy Trigger
    destroy_trigger = {
        exists = owner
        OR = {
            owner = { is_machine_empire = no }
            buildings_no_crystals = yes
        }
    }
	
	# Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db2_minerals #@b2_minerals
            rare_crystals = @db2_rare_cost #@b2_rare_cost
        }
        upkeep = {
            energy = @db2_upkeep #3
            rare_crystals = @db2_rare_upkeep #@b2_rare_upkeep
        }
    }

	# Building Conversions
    convert_to = {
        building_paradise_dome
        building_expanded_warren
        building_communal_housing_large
    }

	# Permanent Planet Modifiers
    planet_modifier = {
        planet_housing_add = 8
        planet_amenities_add = 6
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_drone_megastorage_tt
    }
	
	# Building Upgrades
    upgrades = {
        "building_eutab_gaia_district"
    }
}

##################################################
## Expanded Warren (Tier 2, Shelter) [Vanilla] - Hive Mind Empire
##################################################
building_expanded_warren = {
    base_buildtime = @db2_time #@b2_time
    can_build = no
    category = amenity

	# Building Potential
    potential = {
		exists = owner
        OR = { # Must be one of the following
            NOR = { # Not a habitat
				is_planet_class = pc_habitat
				is_pd_habitat = yes
            }
            AND = { # Advanced habitat with an owner who has Voidborn ascension perk
                has_planet_flag = advanced_habitat
                owner = { has_ascension_perk = ap_voidborn }
            }
        }
		is_hive_empire = yes
    }
	# Tech Prereqs
    prerequisites = {
        "tech_housing_2"
    }
    show_tech_unlock_if = {
        owner = { is_hive_empire = yes }
    }
	# Allow Conditions
    allow = {
        has_upgraded_capital = yes
    }
	# Destroy Trigger
    destroy_trigger = {
		exists = owner
        OR = {
            owner = { is_hive_empire = no }
            buildings_no_crystals = yes
        }
    }
	
	# Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db2_minerals #@b2_minerals
            rare_crystals = @db2_rare_cost #@b2_rare_cost
        }
        upkeep = {
            energy = @db2_upkeep #3
            rare_crystals = @db2_rare_upkeep #@b2_rare_upkeep
        }
    }

	# Building Conversions
    convert_to = {
        building_paradise_dome
        building_drone_megastorage
        building_communal_housing_large
    }

	# Permanent Planet Modifier
    planet_modifier = {
        planet_housing_add = 6
        planet_amenities_add = 10
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_expanded_warren_tt
    }
	
	# Building Upgrades
    upgrades = {
        "building_eutab_gaia_district"
    }
}

##################################################
## Gaia District (Tier 4, Shelter) [EUTAB]
##################################################
building_eutab_gaia_district = {
	base_buildtime = @db4_time #@b2_time
	can_build = no
	category = amenity
	
	# Building Potential
    potential = {
		exists = owner
        OR = { # Must be one of the following
            NOR = { # Not a habitat
				is_planet_class = pc_habitat
				is_pd_habitat = yes
            }
            AND = { # Advanced habitat with an owner who has Voidborn ascension perk
                has_planet_flag = advanced_habitat
                owner = { has_ascension_perk = ap_voidborn }
            }
        }
    }
	# Tech Prereqs
	prerequisites = {
		"tech_eutab_gaia_district"
	}
	# Allow Conditions
	allow = {
		has_major_upgraded_capital = yes
	}
	
	# Resources
	resources = {
		category = planet_buildings
		cost = {
			minerals = @db4_minerals #@b2_minerals
			rare_crystals = @db4_rare_cost #50
		}
		upkeep = {
			energy = @db4_upkeep #@b2_upkeep
			rare_crystals = @db4_rare_upkeep
		}
	}
	
	# Permanent Planet Modifier
	planet_modifier = {
		planet_housing_add = 15
		planet_amenities_add = 15
	}
	# Additional housing and unity output from Keepers of Harmony civic [Civics & Ethics: Bug Branch]
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_bugged_keepers_of_harmony = yes }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.1
            planet_housing_add = 2
        }
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = tech_eutab_gaia_district_tt
    }
	
	# Building Upgrades
    upgrades = {
        "building_fe_sky_dome"
    }
}

##################################################
## Sky Dome (Tier 6, Shelter) [AOT]
##################################################
building_fe_sky_dome = {
    base_buildtime = @db6_time #360
    can_build = no
    icon = building_fe_dome
    category = amenity
	
	# Tech Prereqs
    prerequisites = {
        "tech_fe_sky_dome"
    }
	# Allow Conditions
    allow = {
        has_enigmatic_capital = yes
    }
	
	# Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db6_minerals #750
            rare_crystals = @db6_rare_cost #100
			acot_sr_dark_energy = @db6_dark_cost
        }
        upkeep = {
            rare_crystals = @db6_rare_upkeep
			acot_sr_dark_energy = @db6_dark_upkeep
        }
    }

	# Permanent Planet Modifier
    planet_modifier = {
        planet_housing_add = 40 #50
        planet_amenities_add = 40 #50
    }
	# Additional housing and unity output from Keepers of Harmony civic [Civics & Ethics: Bug Branch]
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_bugged_keepers_of_harmony = yes }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.1
            planet_housing_add = 2
        }
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_fe_sky_dome_tt
    }

	# Building Upgrades
    upgrades = {
        "building_ae_sky_dome"
    }
}

##################################################
## Star Dome (Tier 7, Shelter) [ACOT]
##################################################
building_ae_sky_dome = {
    base_buildtime = @db7_time #600
    can_build = no
    category = amenity

	# Tech Prereqs
    prerequisites = {
        "tech_aot_ae_sky_dome"
    }
	# Allow Conditions
    allow = {
        has_ascended_capital = yes
    }

	# Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db7_minerals #150
            rare_crystals = @db7_rare_cost
            sr_dark_matter = @db6_dark_cost #750
            acot_sr_dark_energy = @db6_dark_cost #750
        }
        upkeep = {
            rare_crystals = @db7_rare_upkeep
            sr_dark_matter = @db6_dark_upkeep
            acot_sr_dark_energy = @db6_dark_upkeep
        }
    }
	
	# Permanent Planet Modifier
    planet_modifier = {
        planet_housing_add = 80 #100
        planet_amenities_add = 80 #100
    }
	# Additional housing and unity output from Keepers of Harmony civic [Civics & Ethics: Bug Branch]
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_bugged_keepers_of_harmony = yes }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.1
            planet_housing_add = 2
        }
    }
	# Additional housing from Domination tradition's Imperious Architecture perk.
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_active_tradition = tr_domination_imperious_architecture }
        }
        modifier = {
            planet_housing_add = 1
        }
    }
	# Additional housing from Habitation Studies technology [EUTAB].
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = tech_eutab_habitation_studies }
        }
        modifier = {
            planet_housing_add = 3
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_ae_sky_dome_tt
    }

	# Building Upgrades
    upgrades = {
        "building_stellarite_sky_dome"
    }
}

##################################################
## Planetary Shield Generator (Tier 2, Shielding) [Vanilla]
##################################################
building_planetary_shield_generator = {
    base_buildtime = @db1_time #600
    position_priority = 100
    can_build = no
    category = army

    # Tech Prereqs
    prerequisites = {
        "tech_planetary_shield_generator"
    }
    # Allow Conditions
    allow = {
        doge_can_build_planetary_shield = yes # Ensure there's not already a planetary shield.
        has_upgraded_capital = yes
    }
    # Destroy Trigger
    # Not needed for now
    #destroy_trigger = {
    #    exists = owner
    #    owner = {
    #        is_ai = yes
    #    }
    #    num_buildings = {
    #        type = building_stronghold
    #        value < 1
    #    }
    #    num_buildings = {
    #        type = building_fortress
    #        value < 1
    #    }
    #}
    
    # Resources
    resources = {
        category = planet_buildings
        cost = {
            minerals = @db2_minerals #500
        }
        upkeep = {
            energy = @db2_upkeep #5
        }
    }

    # Permanent Planet Modifier
    planet_modifier = {
        planet_orbital_bombardment_damage = -0.4
        planet_housing_add = 5
        planet_amenities_add = 5
    }

    # Inward Perfection civic gives 20% increased unity from jobs
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_civic = civic_inwards_perfection }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.2
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_planetary_shield_generator_tt
    }

	# Building Upgrades
    upgrades = {
        "building_giga_planetary_shield_generator_1"
    }
}

##################################################
## Hypershield Defensive Screen (Tier 4, Shielding) [Gigastructural Engineering]
##################################################
building_giga_planetary_shield_generator_1 = {
	base_buildtime = @db4_time #@b4_time
    position_priority = 100
    can_build = no
    category = army
	
	prerequisites = {
		"tech_giga_planetary_shield_generator_1"
	}
    # Allow Conditions
	allow = {
		has_major_upgraded_capital = yes
	}
	
    # Resources
	resources = {
		category = planet_buildings
		cost = {
			minerals = @db4_minerals #@b3_minerals
			exotic_gases = @db4_rare_cost #20
		}
		upkeep = {
			energy = @db4_upkeep #@b3_upkeep
			exotic_gases = @db4_rare_upkeep #1
		}
	}
	
    # Permanent Planet Modifier
	planet_modifier = {
		planet_orbital_bombardment_damage = -0.5
        planet_housing_add = 7
        planet_amenities_add = 7
	}
    # Inward Perfection civic gives 20% increased unity from jobs
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_civic = civic_inwards_perfection }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.2
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_giga_planetary_shield_generator_1_tt
    }

	upgrades = {
		#"building_giga_planetary_shield_generator_2"
        "building_dark_energy_psg"
	}
}

##################################################
## Dark Energy Planetary Shield Generator (Tier 6, Shielding) [ACOT]
##################################################
building_dark_energy_psg = {
	base_buildtime = @db6_time #600
	position_priority = 100
    can_build = no
	category = army
	
    # Tech Prereqs
	prerequisites = {
		"tech_dark_energy_psg"
	}
    # Allow Conditions
	allow = {
		has_enigmatic_capital = yes
	}
    
    # Resources
	resources = {
		category = planet_buildings
		cost = {
			minerals = @db6_minerals #150
			exotic_gases = @db6_rare_cost
			acot_sr_dark_energy = @db6_dark_cost #50
		}			
		upkeep = {
			trigger = { owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			exotic_gases = @db6_rare_upkeep
			acot_sr_dark_energy = @db6_dark_upkeep #1
		}
	}
	
    # Permanent Planet Modifier
	planet_modifier = {
		planet_orbital_bombardment_damage = -0.6
        planet_housing_add = 10
        planet_amenities_add = 10
	}
    # Inward Perfection civic gives 20% increased unity from jobs
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_civic = civic_inwards_perfection }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.2
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_dark_energy_psg_tt
    }

    # Building Upgrades
	upgrades = {
		building_ae_dark_energy_psg
	}
}

##################################################
## Sky Shield (Tier 7, Shielding) [ACOT]
##################################################
building_ae_dark_energy_psg = {
    base_buildtime = @db7_time #500
    position_priority = 100
    can_build = no
    category = army

    # Tech Prereqs
    prerequisites = {
        "tech_ae_dark_energy_psg"
    }
    # Allow Conditions
    allow = {
        has_ascended_capital = yes
    }

    # Resources
    resources = {
        category = planet_buildings
        cost = {
            energy = @db7_minerals #1000
            minerals = @db7_minerals #500
            alloys = 500
			exotic_gases = @db7_rare_cost
            acot_sr_dark_energy = @db7_dark_cost #150
        }
        upkeep = {
            trigger = {
                owner = { is_ai = no }
            }
			exotic_gases = @db7_rare_upkeep
            acot_sr_dark_energy = @db7_dark_upkeep #10
        }
    }
    
    # Permanent Planet Modifier
	planet_modifier = {
		planet_orbital_bombardment_damage = -0.7
        planet_housing_add = 15
        planet_amenities_add = 10
	}
    # Inward Perfection civic gives 20% increased unity from jobs
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_civic = civic_inwards_perfection }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.2
        }
    }
    # Building Tooltip
    triggered_desc = {
        text = building_ae_dark_energy_psg_tt
    }

    # Building Upgrades
    upgrades = {
        "building_giga_planetary_shield_generator_2"
        "building_stellarite_psg"
    }
}


##################################################
## Negative Mass Protector (Tier 8, Shielding) [Gigastructural Engineering]
## TODO: Implement properly. Might not be tier 8.
##################################################
building_giga_planetary_shield_generator_2 = {
	base_buildtime = 1200
	can_build = no
	
	allow = {
		has_upgraded_capital = yes
	}
	
	resources = {
		category = planet_buildings
		cost = {
			minerals = @b4_minerals
			exotic_gases = @b2_minerals
			ehof_sr_negative_mass = 20
		}
		upkeep = {
			energy = @b4_upkeep
			exotic_gases = @b2_upkeep
			ehof_sr_negative_mass = 2
		}
	}
	
	planet_modifier = {
		planet_orbital_bombardment_damage = -0.8 #-0.7
	}
	
	prerequisites = {
		"tech_giga_planetary_shield_generator_2"
	}
}