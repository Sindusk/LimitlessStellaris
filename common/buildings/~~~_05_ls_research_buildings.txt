##########################################################################
# Limitless Stellaris - Buildings - Research
##########################################################################

### Key:
### MECR - More Emperor and Custodian Resolutions

##################################################
## Research - Basic
##################################################

## Research Labs (Tier 1)
# Merge between Sort Buildings, Real Space: Plantary Stations, StarTech, Ariphaos
# Has custom inline script.
building_research_lab_1 = {
	base_buildtime = @db1_time
	position_priority = 4051000 # Sort Buildings

	exempt_from_ai_planet_specialization = no

	category = research
	
    # Building Tooltip
    triggered_desc = {
        text = building_research_lab_1_tt
    }

	potential = {
		NOR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
			has_planet_flag = planetary_station # Real Space: Planetary Stations
		}
	}

	destroy_trigger = {
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
		}
	}

	allow = {
		str_research_allow = yes # StarTech AI
	}

	inline_script = { # Adds the researcher jobs based on proper conditions.
		script = buildings/research/research_jobs
		basic = @db1_jobs
		adv = @db1_adv_jobs
		dm = @db1_dm_jobs
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @db1_minerals
		}
		upkeep = {
			energy = @db1_upkeep
		}
	}

	upgrades = {
		"building_research_lab_2"
	}

	prerequisites = {
		"tech_basic_science_lab_1"
	}
	
	# StarTech AI Resource Production
	ai_resource_production = {
		trigger = { always = yes }
		physics_research = 1
		society_research = 1
		engineering_research = 1
	}
}

## Research Complexes (Tier 2)
# Using StarTech.
# Has custom inline script.
building_research_lab_2 = {
	base_buildtime = @db2_time
	can_build = no

	category = research

    # Building Tooltip
    triggered_desc = {
        text = building_research_lab_2_tt
    }

	allow = {
		has_upgraded_capital = yes
		buildings_has_exotic_gases = yes # StarTech AI
		hidden_trigger = { # StarTech AI
			OR = {
				owner = { is_ai = no }
				AND = {
					free_building_slots = 0
					free_district_slots < 3
					free_jobs < 2
					OR = {
						is_capital = yes
						str_is_col_research = yes
						num_unemployed > 1
					}
					free_housing > 5
					str_research_allow = yes
				}
			}
		}
	}

	destroy_trigger = {
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
			AND = { # StarTech AI
				buildings_no_exotic_gases = yes
				has_planet_flag = str_supervisor
			}
			str_research_destroy = yes # StarTech AI
		}
	}

	inline_script = { # Adds the researcher jobs based on proper conditions.
		script = buildings/research/research_jobs
		basic = @db2_jobs
		adv = @db2_adv_jobs
		dm = @db2_dm_jobs
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @db2_minerals
			exotic_gases = @db2_rare_cost
		}
		upkeep = {
			energy = @db2_upkeep
			exotic_gases = @db2_rare_upkeep
		}
	}

	upgrades = {
		"building_research_lab_3"
	}

	prerequisites = {
		"tech_basic_science_lab_2"
	}
}

## Advanced Research Complexes (Tier 3)
# Merge between New Galactic System, StarTech, Ariphaos
# Has custom inline script.
building_research_lab_3 = {
	base_buildtime = @db3_time
	can_build = no

	category = research

    # Building Tooltip
    triggered_desc = {
        text = building_research_lab_3_tt
    }

	allow = {
		has_major_upgraded_capital = yes
		buildings_has_exotic_gases = yes # StarTech AI
		hidden_trigger = { # StarTech AI
			OR = {
				owner = { is_ai = no }
				AND = {
					free_building_slots = 0
					free_district_slots < 3
					free_jobs < 2
					OR = {
						is_capital = yes
						str_is_col_research = yes
						num_unemployed > 1
					}
					free_housing > 5
					str_research_allow = yes
				}
			}
		}
	}

	destroy_trigger = {
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
			AND = { # StarTech AI
				buildings_no_exotic_gases = yes
				has_planet_flag = str_supervisor
			}
			str_research_destroy = yes # StarTech AI
		}
	}

	inline_script = { # Adds the researcher jobs based on proper conditions.
		script = buildings/research/research_jobs
		basic = @db3_jobs
		adv = @db3_adv_jobs
		dm = @db3_dm_jobs
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				is_gestalt = no
				is_galactic_community_member = yes
			}
			OR = {
				is_active_resolution = "resolution_galacticstudies_extradimensional_experimentation"
				is_active_resolution = "resolution_galacticstudies_6" # New Galactic System
			}
			has_modifier = pm_extradimensional_experimentation
		}
		modifier = {
			job_dimensional_portal_researcher_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				is_gestalt = yes
				is_galactic_community_member = yes
			}
			OR = {
				is_active_resolution = "resolution_galacticstudies_extradimensional_experimentation"
				is_active_resolution = "resolution_galacticstudies_6" # New Galactic System
			}
			has_modifier = pm_extradimensional_experimentation
		}
		modifier = {
			job_dimensional_portal_researcher_gestalt_add = 1
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @db3_minerals
			exotic_gases = @db3_rare_cost
		}
		upkeep = {
			energy = @db3_upkeep
			exotic_gases = @db3_rare_upkeep
		}
		upkeep = {
			trigger = {
				owner = {
					is_galactic_community_member = yes
				}
				OR = {
					is_active_resolution = "resolution_galacticstudies_extradimensional_experimentation"
					is_active_resolution = "resolution_galacticstudies_6" # New Galactic System
				}
				planet = {
					has_modifier = pm_extradimensional_experimentation
				}
			}
			sr_zro = 1
		}
	}

	prerequisites = {
		"tech_basic_science_lab_3"
	}
}

##################################################
## Research - Unique
##################################################

## Research Institute (Tier 1)
# Merge between Sort Buildings, EUTAB, Bug Branch, Real Space: Planetary Stations, MECR, StarTech
building_institute = {
	base_buildtime = @db2_time
	base_cap_amount = 1
	position_priority = 2052000 # Sort Buildings

	category = research

    # Building Tooltip
    triggered_desc = {
        text = building_institute_tt
    }

	potential = {
		NOR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
			has_planet_flag = planetary_station # Real Space: Planetary Stations
		}
		exists = owner
		owner = { is_gestalt = no }
		owner = { # StarTech AI
			OR = {
				is_ai = no
				lategame = no
			}
		}
	}

	destroy_trigger = {
		exists = owner
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
			owner = { is_regular_empire = no }
			buildings_no_exotic_gases = yes # StarTech AI
			str_research_destroy = yes # StarTech AI
		}
	}

	convert_to = {
		building_supercomputer
	}

	allow = {
		has_major_upgraded_capital = yes
		hidden_trigger = { # StarTech AI
			exists = owner
			OR = {
				owner = { is_ai = no }
				OR = {
					num_buildings = {
						type = building_research_lab_1
						value > 3
					}
					num_buildings = {
						type = building_research_lab_2
						value > 1
					}
					num_buildings = {
						type = building_research_lab_3
						value > 1
					}
				}
				str_is_col_research = yes
			}
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @db2_minerals
			exotic_gases = @db2_rare_cost
		}
		upkeep = {
			energy = @db2_upkeep
			exotic_gases = @db2_rare_upkeep
		}
	}

	upgrades = {
		building_eutab_genetic_data_vault # EUTAB
		building_eutab_afterlife_vault # EUTAB
		building_eutab_foundation_institute_1 # EUTAB
		#building_avb_institute_2 # Additional Vanilla Buildings
	}

	planet_modifier = {
		planet_researchers_produces_mult = 0.15
		job_head_researcher_add = 1
	}
	
	triggered_planet_modifier = { # MECR
		potential = {
			is_active_resolution = resolution_custodian_galactic_academy_of_sciences
			owner = {
				has_federation = yes
				federation = {
					has_federation_perk = galactic_confederation_passive
					has_federation_perk = research_galconfed_specialization_bonus_1
				}
			}
		}
		planet_researchers_physics_research_produces_add = 0.4
		planet_researchers_society_research_produces_add = 0.4
		planet_researchers_engineering_research_produces_add = 0.4
		mult = owner.value:building_institute_galactic_academy_of_sciences_galconfed_specialization
	}
	
	triggered_planet_modifier = { # MECR
		potential = {
			is_active_resolution = resolution_custodian_galactic_academy_of_sciences
			has_modifier = assist_research
		}
		planet_researchers_physics_research_produces_add = 0.2
		planet_researchers_society_research_produces_add = 0.2
		planet_researchers_engineering_research_produces_add = 0.2
		mult = value:building_institute_galactic_academy_of_sciences_assist_research
	}

	triggered_planet_modifier = { # Bug Branch
		potential = {
			exists = owner
			owner = {
				has_civic = civic_bugged_research_cooperatives
			}
		}
		modifier = {
			planet_jobs_unity_produces_mult = 0.05

		}
	}

	prerequisites = {
		"tech_global_research_initiative"
	}

	triggered_desc = {
		text = job_head_researcher_effect_desc
	}

	show_tech_unlock_if = {
		is_gestalt = no
	}

	# StarTech AI Resource Production
	ai_resource_production = {
		trigger = { always = yes }
		physics_research = 5
		society_research = 5
		engineering_research = 5
	}
	ai_resource_production = {
		trigger = {
			OR = {
				num_buildings = {
					type = building_research_lab_1
					value > 2
				}
				num_buildings = {
					type = building_research_lab_2
					value > 1
				}
				num_buildings = {
					type = building_research_lab_3
					value > 1
				}
			}
		}
		physics_research = 5
		society_research = 5
		engineering_research = 5
	}
	ai_resource_production = {
		trigger = {
			OR = {
				num_buildings = {
					type = building_research_lab_1
					value > 4
				}
				num_buildings = {
					type = building_research_lab_2
					value > 2
				}
				num_buildings = {
					type = building_research_lab_3
					value > 1
				}
			}
		}
		physics_research = 5
		society_research = 5
		engineering_research = 5
	}
}

## Planetary Supercomputer (Tier 1)
# Merge between Sort Buildings, EUTAB, Bug Branch, Real Space: Planetary Stations, MECR, StarTech
building_supercomputer = {
	base_buildtime = @db2_time
	base_cap_amount = 1
	icon = building_institute
	position_priority = 2052000 # Sort Buildings

	category = research

    # Building Tooltip
    triggered_desc = {
        text = building_supercomputer_tt
    }

	potential = {
		exists = owner
		owner = { is_gestalt = yes }
		NOR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
			has_planet_flag = planetary_station # Real Space: Planetary Stations
		}
	}

	allow = {
		has_major_upgraded_capital = yes
		hidden_trigger = { # StarTech AI
			OR = {
				owner = { is_ai = no }
				OR = {
					num_buildings = {
						type = building_research_lab_1
						value > 2
					}
					num_buildings = {
						type = building_research_lab_2
						value > 1
					}
					num_buildings = {
						type = building_research_lab_3
						value > 1
					}
				}
				str_is_col_research = yes
			}
		}
	}

	destroy_trigger = {
		exists = owner
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
			owner = { is_regular_empire = yes }
			str_research_destroy = yes # StarTech AI
		}
	}

	convert_to = {
		building_institute
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @db2_minerals
		}
		upkeep = {
			energy = @db2_upkeep
		}
	}

	upgrades = {
		building_eutab_hypercomputing_complex # EUTAB
		building_avb_supercomputer_2 # Additional Vanilla Buildings
	}

	planet_modifier = {
		planet_researchers_produces_mult = 0.15
	}
	
	triggered_planet_modifier = { # MECR
		potential = {
			is_active_resolution = resolution_custodian_galactic_academy_of_sciences
			owner = {
				has_federation = yes
				federation = {
					has_federation_perk = galactic_confederation_passive
					has_federation_perk = research_galconfed_specialization_bonus_1
				}
			}
		}
		planet_researchers_physics_research_produces_add = 0.4
		planet_researchers_society_research_produces_add = 0.4
		planet_researchers_engineering_research_produces_add = 0.4
		mult = owner.value:building_institute_galactic_academy_of_sciences_galconfed_specialization
	}
	
	triggered_planet_modifier = { # MECR
		potential = {
			is_active_resolution = resolution_custodian_galactic_academy_of_sciences
			has_modifier = assist_research
		}
		planet_researchers_physics_research_produces_add = 0.2
		planet_researchers_society_research_produces_add = 0.2
		planet_researchers_engineering_research_produces_add = 0.2
		mult = value:building_institute_galactic_academy_of_sciences_assist_research
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		modifier = {
			job_brain_drone_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		modifier = {
			job_calculator_add = 1
		}
	}

	triggered_planet_modifier = { # Bug Branch
		potential = {
			exists = owner
			owner = { has_civic = civic_bugged_machine_researcher }
		}
		modifier = {
			job_bugged_examinatron_add = 1
			#job_calculator_add = -1
		}
	}

	prerequisites = {
		"tech_global_research_initiative"
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		text = job_brain_drone_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		text = job_calculator_effect_desc
	}

	triggered_desc = { # Bug Branch
		trigger = {
			exists = owner
			owner = { has_civic = civic_bugged_machine_researcher }
		}
		text = job_bugged_examinatron_effect_desc
	}

	show_tech_unlock_if = {
		is_gestalt = yes
	}
	
	# StarTech AI Resource Production
	ai_resource_production = {
		trigger = { always = yes }
		physics_research = 3
		society_research = 3
		engineering_research = 3
	}
	ai_resource_production = {
		trigger = {
			OR = {
				num_buildings = {
					type = building_research_lab_1
					value > 2
				}
				num_buildings = {
					type = building_research_lab_2
					value > 1
				}
				num_buildings = {
					type = building_research_lab_3
					value > 1
				}
			}
		}
		physics_research = 3
		society_research = 3
		engineering_research = 3
	}
	ai_resource_production = {
		trigger = {
			OR = {
				num_buildings = {
					type = building_research_lab_1
					value > 4
				}
				num_buildings = {
					type = building_research_lab_2
					value > 2
				}
				num_buildings = {
					type = building_research_lab_3
					value > 1
				}
			}
		}
		physics_research = 3
		society_research = 3
		engineering_research = 3
	}
}

## Faculty of Archaeostudies (Tier 1)
# Merge between Sort Buildings, OSA, Planetary Diversity, Real Space: Planetary Stations, Guilli's Planet Modifiers
building_archaeostudies_faculty = {
	base_buildtime = @db2_time
	position_priority = 1051000 # Sort Buildings

	category = research

    # Building Tooltip
    triggered_desc = {
        text = building_archaeostudies_faculty_tt
    }

	empire_limit = {
	 	base = 1
	}

	potential = {
		NOR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
			has_planet_flag = planetary_station # Real Space: Planetary Stations
		}
		exists = owner
	}

	destroy_trigger = {
		exists = owner
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
		}
	}

	allow = {
		has_upgraded_capital = yes
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @db2_minerals
			minor_artifacts = 50
		}
		upkeep = {
			energy = 20
		}
		produces = { # OSA
			trigger = {
				owner = {
					has_active_tradition = tr_insight_3
				}
			}
			physics_research = 20
		}
	}

	planet_modifier = { # OSA
		planet_researchers_produces_mult = 0.25
	}

	triggered_planet_modifier = { # OSA
		potential = {
			exists = owner
			owner = { has_ascension_perk = ap_archaeoengineers }
		}
		planet_researchers_produces_mult = 0.25
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = no }
		}
		modifier = {
			job_archaeoengineers_add = 3
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		modifier = {
			job_archaeo_drone_add = 3
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		modifier = {
			job_archaeo_unit_add = 3
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { 
				is_gestalt = no
				has_ascension_perk = ap_archaeoengineers
			}
		}
		modifier = {
			job_archaeoengineers_add = 2
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				is_hive_empire = yes
				has_ascension_perk = ap_archaeoengineers
			}
		}
		modifier = {
			job_archaeo_drone_add = 2
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				is_machine_empire = yes
				has_ascension_perk = ap_archaeoengineers
			}
		}
		modifier = {
			job_archaeo_unit_add = 2
		}
	}

	country_modifier = {
		category_archaeostudies_research_speed_mult = 1.0
		country_resource_max_minor_artifacts_add = 1000
	}

	triggered_country_modifier = {
		potential = {
			exists = owner
			owner = {
				has_ascension_perk = ap_archaeoengineers
			}
		}
		country_resource_max_minor_artifacts_add = 2000
	}

	triggered_country_modifier = {
		potential = { 
			planet = { 
				OR = { # Planetary Diversity
					is_planet_class = pc_relic
					is_planet_class = pc_nuked_relic
					is_planet_class = pc_milarc_relic
					is_planet_class = pc_pd_scrapyard
				}
			} 
		}
		category_archaeostudies_research_speed_mult = 0.5
	}
	
	triggered_country_modifier = { # Guilli's Planet Modifiers
		potential = { planet = { is_planet_class = pc_gpm_precursor_tomb } }
		category_archaeostudies_research_speed_mult = 1.0
	}

	prerequisites = {
		"tech_archaeostudies"
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = no }
		}
		text = job_archaeoengineers_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		text = job_archaeo_drone_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		text = job_archaeo_unit_effect_desc
	}

	triggered_desc = {
		text = building_archaeostudies_faculty_relic_effect
	}
}

## Vultaum Reality Computer (Tier 1)
# Merge between Sort Buildings, Real Space: Planetary Stations
building_vultaum_reality_computer = {
	base_buildtime = @db2_time
	base_cap_amount = 1
	position_priority = 2051000 # Sort Buildings

	category = research

    # Building Tooltip
    triggered_desc = {
        text = building_vultaum_reality_computer_tt
    }

	potential = {
		exists = owner
		NOR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
			has_planet_flag = planetary_station # Real Space: Planetary Stations
		}
	}

	allow = {
		has_major_upgraded_capital = yes
	}

	destroy_trigger = {
		exists = owner
		OR = {
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = crucible_colony
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @db2_minerals
			minor_artifacts = 30
		}
		upkeep = {
			energy = @b2_upkeep
		}
	}

	planet_modifier = {
		planet_researchers_physics_research_produces_add = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { has_ascension_perk = ap_archaeoengineers }
		}
		planet_researchers_physics_research_produces_add = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_gestalt = no }
		}
		modifier = {
			job_head_researcher_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		modifier = {
			job_brain_drone_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		modifier = {
			job_calculator_add = 1
		}
	}

	prerequisites = {
		"tech_secrets_vultaum"
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_gestalt = no }
		}
		text = job_head_researcher_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_hive_empire = yes }
		}
		text = job_brain_drone_effect_desc
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_machine_empire = yes }
		}
		text = job_calculator_effect_desc
	}
}
