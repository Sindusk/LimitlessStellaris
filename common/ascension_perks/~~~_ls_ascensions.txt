##########################################################################
# Limitless Stellaris Ascension Changes
##########################################################################

### Key:
### SAP - Sartek Ascension Perks
### EMEX - Empires Expanded
### MEM - More Events Mod
### PTEP - Plentiful Traditions - Extra Perks
### UAP - Unique Ascension Perks
### WAP - Worthy Ascension Perks

##################################################
## Vanilla Ascension Perks
##################################################

### ap_arcology_project
## Arcology Project (Vanilla)
# Merge between SAP, StarTech, and Electroids Species Pack
ap_arcology_project = {
	potential = {
		host_has_dlc = "Megacorp"
		OR = {
			is_regular_empire = yes
			is_servitor_empire = yes
		}
		NOT = { is_agrarian_empire = yes }
		NOT = {
			has_ascension_perk = ap_arcology_project
		}
		NOR = { # Electroids Block
			has_origin = origin_elec_sun_empire
			has_origin = origin_elec_supernova
			has_origin = origin_elec_endless_horizon
			has_origin = origin_elec_extradimensionals
			has_origin = origin_elec_nebula_of_creation
		}
	}

	possible = {
		custom_tooltip = {
			fail_text = "requires_technology_housing_2"
			has_technology = tech_housing_2
		}
		custom_tooltip = {
			fail_text = "requires_ascension_perks_2"
			num_ascension_perks > 1
		}
	}

	on_enabled = {
		custom_tooltip = "allow_arcology_project"
		custom_tooltip = "decision_arcology_project_effects"
	}

	ai_weight = {
		factor = 1000
		modifier = {
			factor = 10
			resource_stockpile_compare = { resource = minerals value > 8000 }
			nor = {
				has_ascension_perk = ap_mind_over_matter
				has_ascension_perk = ap_the_flesh_is_weak
				has_ascension_perk = ap_engineered_evolution
			}
		}
		modifier = {
			factor = 200
			or = {
				has_ascension_perk = ap_transcendence
				has_ascension_perk = ap_synthetic_evolution
				has_ascension_perk = ap_evolutionary_mastery
			}
		}
		modifier = {
			factor = 0
			or = {
				has_origin = origin_remnants
				has_ecumen = yes
			}
		}
		modifier = {
			factor = 50
			is_pacifist = yes
		}
		modifier = {
			factor = 5
			num_pops > 300
		}
	}
}

### ap_become_the_crisis
## Become The Crisis (Vanilla)
# Merge between SAP, StarTech, and DarkSpace
ap_become_the_crisis = {
	potential = {
		has_nemesis = yes
		NOR = {
			# Dark Space Origins
			has_origin = origin_spectrals_cluster
			has_origin = origin_certast_cluster
			has_origin = origin_gray_tempest
			has_origin = origin_ds_nomads
			has_origin = origin_halo
			# Dark Space Ascensions
			has_ascension_perk = ap_halo_crisis
			has_ascension_perk = ap_gray_salvation
			# Normal checks
			has_ascension_perk = ap_become_the_crisis
			is_minamar = yes
		}
	}

	possible = {
		custom_tooltip = {
			fail_text = "requires_ascension_perks_2"
			num_ascension_perks > 1
		}
		custom_tooltip = {
			fail_text = "requires_independence"
			is_subject = no
		}
		custom_tooltip = {
			fail_text = "must_not_be_custodian"
			is_galactic_custodian = no
		}
		custom_tooltip = {
			fail_text = "must_not_be_emperor"
			is_galactic_emperor = no
		}
		NOR = {
			has_ethic = ethic_xenophile
			has_ethic = ethic_fanatic_xenophile
			has_ethic = ethic_pacifist
			has_ethic = ethic_fanatic_pacifist
			is_servitor_empire = yes
		}
	}

	on_enabled = {
		hidden_effect = {
			set_ai_personality = became_the_crisis
		}
		activate_crisis_progression = yes
	}

	ai_weight = {
		factor = 7.5
		modifier = {
			factor = 0
			nor = {
				is_militarist = yes
				is_xenophobe = yes
				is_gestalt = yes
				and = {
					is_authoritarian = yes
					is_spiritualist = yes
				}
			}
		}
		modifier = {
			factor = 10
			is_homicidal = yes
		}
		modifier = {
			factor = 0
			or = {
				fleet_power < 100000
				and = {
					has_country_flag = str_has_bad_economy_score
					has_country_flag = str_has_bad_fleet_score
				}
				has_country_flag = str_has_terrible_economy_score
				has_country_flag = str_has_terrible_fleet_score
				has_country_flag = str_has_terrible_tech_score
			}
		}
		modifier = {
			factor = 2
			has_tradition = tr_supremacy_finish
		}
		modifier = {
			factor = 10
			num_ascension_perks > 2
			resource_income_compare = {
				resource = alloys
				value > 200
			}
			resource_income_compare = {
				resource = physics_research
				value > 500
			}
			rusher2 = yes
		}

		modifier = {
			factor = 0
			galaxy_percentage < 0.05
			minilategame = no
		}
		modifier = {
			factor = 5
			galaxy_percentage > 0.2
		}
		modifier = {
			factor = 100
			minilategame = yes
			rusher = yes
			num_ascension_perks > 3
			resource_income_compare = {
				resource = alloys
				value > 200
			}
		}
		modifier = {
			factor = 0
			count_playable_country = {
				count > 2
				limit = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		modifier = {
			factor = 0
			count_playable_country = {
				count > 1
				limit = {
					has_ascension_perk = ap_become_the_crisis
				}
			}
			num_ascension_perks < 4
		}
	}
}

### ap_colossus
## Colossus Project (Vanilla)
# Merge between SAP, StarTech, and Civic: Organic Zealots
ap_colossus = {
	potential = {
		host_has_dlc = "Apocalypse"
		NOT = { has_ascension_perk = ap_colossus }
	}

	on_enabled = {
		custom_tooltip = enable_colossus_project
		custom_tooltip = describe_colossus_project
		hidden_effect = {
			country_event = { id = apoc.100 }
		}
	}

	possible = {
		has_technology = tech_titans
		custom_tooltip = {
			fail_text = "requires_ascension_perks_3"
			num_ascension_perks > 2
		}
	}

	ai_weight = {
		factor = 20
		modifier = {
			factor = 100
			has_ascension_perk = ap_world_shaper
			resource_income_compare = {
				resource = energy
				value > 50
			}
		}
		modifier = {
			factor = 0
			OR = {
				has_valid_civic = civic_fanatic_purifiers
				is_valid_organic_zealots = yes
				has_valid_civic = civic_machine_terminator
			}
		}
		modifier = {
			factor = 0.1
			is_xenophile = yes
		}
		modifier = {
			factor = 0.25
			is_pacifist = yes
		}
		modifier = {
			factor = 2
			is_xenophobe = yes
		}
		modifier = {
			factor = 2
			is_militarist = yes
		}
		modifier = {
			factor = 2
			is_machine_empire = yes #just because
		}
		modifier = {
			factor = 2
			has_ascension_perk = ap_become_the_crisis
		}
		modifier = {
			factor = 0
			has_crisis_level = crisis_level_5
		}
	}
}

### ap_consecrated_worlds
## Consecrated Worlds (Vanilla)
# Merge between SAP, PTEP, EMEX, StarTech, Worthy Ascension Perks, and Utopian Dream
# Base from SAP, potential blockers from EMEX, modifiers from Utopian Dream, enable trigger from Worthy Ascension Perks, disabled for AI by StarTech.
ap_consecrated_worlds = {
	on_enabled = {
		custom_tooltip = "allow_edict_consectrated_worlds"
		custom_tooltip = "describe_edict_consectrated_worlds_worthy"
		hidden_effect = {
			country_event = {
				id = worthyperks.05
			}
		}
	}

	potential = {
		NOR = {
			has_ascension_perk = ap_consecrated_worlds
			has_ascension_perk = ap_consecrated_worlds_nihilistic # EMEX
			is_nihil_cult_emex = yes # EMEX
		}
		OR = {
			has_ethic = ethic_spiritualist
			has_ethic = ethic_fanatic_spiritualist
		}
	}
	
	modifier = { # Utopian Dream Modifiers
		pop_ethic_spiritualist_attraction_mult = 0.25
		planet_priests_consumer_goods_upkeep_mult = -0.5
		planet_priests_produces_mult = 0.25
	}

	ai_weight = { # StarTech AI disables this perk.
		factor = 0
	}
}

### ap_defender_of_the_galaxy
## Defender of the Galaxy (Vanilla)
# Merge between SAP, Utopian Dream
# Base from SAP, changes from Unique Ascension Perks, compat with MEM from MEM & Gigas Patch, AI Weight from StarTech
ap_defender_of_the_galaxy = {
	possible = {
		custom_tooltip = {
			fail_text = "requires_ascension_perks_3"
			num_ascension_perks > 2
		}
	}
	modifier = {
		# Vanilla
		description = ls_ap_defender_of_the_galaxy_modifier_desc
		custom_tooltip = "ap_defender_of_the_galaxy_effect_opinion" # Unique Ascension Perks
		diplo_weight_mult = 0.4 # Buffed by Unique Ascension Perks. Default value 0.2
		damage_vs_country_type_swarm_mult = 0.5
		damage_vs_country_type_extradimensional_mult = 0.5
		damage_vs_country_type_extradimensional_2_mult = 0.5
		damage_vs_country_type_extradimensional_3_mult = 0.5
		damage_vs_country_type_ai_empire_mult = 0.5
		damage_vs_country_type_gray_goo_mult = 0.5
		damage_vs_player_crisis_mult = 0.5
		# More Events Mod
		damage_vs_country_type_mem_vazurans_mult = 0.5
		# Gigastructural Engineering & More
		damage_vs_country_type_compound_empire_mult = 0.5
		damage_vs_country_type_katzenartig_imperium_mult = 0.5
		damage_vs_country_type_dormant_aeternum_mult = 0.5
		damage_vs_country_type_blokkat_stripminers_mult = 0.5
		# More Events Mod
		damage_vs_country_type_mem_vazurans_mult = 0.5
		# Utopian Dream
		damage_vs_country_type_marauder_raiders_mult = 1.0
		damage_vs_country_type_awakened_marauders_mult = 1.0
		damage_vs_country_type_ruined_marauders_mult = 1.0
		damage_vs_country_type_dormant_marauders_mult = 1.0
		damage_vs_country_type_pirate_mult = 1.0
		country_trust_growth = 0.25
		# Unique Ascension Perks merges Galactic Contender with this one. These modifiers are from Galactic Contender
		damage_vs_country_type_fallen_empire_mult = 0.33
		damage_vs_country_type_awakened_fallen_empire_mult = 0.33
		damage_vs_country_type_gate_builders_mult = 0.33
	}

	on_enabled = {
		custom_tooltip = "ap_defender_of_the_galaxy_effect_opinion"
		# see triggered_opinion_ap_defender_of_the_galaxy
		custom_tooltip = "ap_defender_of_the_galaxy_sartek_trust_growth"
	}

	potential = {
		NOR = {
			has_ascension_perk = ap_defender_of_the_galaxy
			has_ascension_perk = ap_galactic_contender # Disabled by Unique Ascension Perks, but incompatible just in case
		}
	}

	ai_weight = {
		factor = 5 # Base of 5 from StarTech
		modifier = {
			factor = 0
			NOR = {
				is_xenophile = yes
				is_galactic_custodian = yes
				is_galactic_emperor = yes
				any_country = {
					OR = {
						# Vanilla
						has_crisis_level = crisis_level_5
						is_country_type = swarm
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
						is_country_type = ai_empire
						is_country_type = gray_goo
						# More Events Mod
						is_country_type = mem_vazurans
						# Gigastructural Engineering & More
						is_country_type = compound_empire
						is_country_type = dormant_aeternum
						is_country_type = katzenartig_imperium
						is_country_type = blokkat_stripminers
					}
				}
			}
		}
		modifier = {
			factor = 100
			OR = {
				is_galactic_custodian = yes
				is_galactic_emperor = yes
			}
		}
		modifier = {
			factor = 0.25
			NOT = {
				any_country = {
					OR = {
						# Vanilla
						has_crisis_level = crisis_level_5
						is_country_type = swarm
						is_country_type = extradimensional
						is_country_type = extradimensional_2
						is_country_type = extradimensional_3
						is_country_type = ai_empire
						is_country_type = gray_goo
						# More Events Mod
						is_country_type = mem_vazurans
						# Gigastructural Engineering & More
						is_country_type = compound_empire
						is_country_type = dormant_aeternum
						is_country_type = katzenartig_imperium
						is_country_type = blokkat_stripminers
					}
				}
			}
		}
		# StarTech AI modifiers
		modifier = {
			factor = 5
			has_global_flag = galactic_crisis_happened
		}
		modifier = {
			factor = 0
			NOR = {
				has_global_flag = galactic_crisis_happened
				has_global_flag = gray_goo_crisis_active
				any_country = {
					relative_power = {
						who = prev
						value > equivalent
					}
					has_ascension_perk = ap_become_the_crisis
				}
			}
		}
		modifier = {
			factor = 100
			has_global_flag = galactic_crisis_happened
			fleet_power < 200000
		}
		modifier = {
			factor = 100
			any_country = {
				has_ascension_perk = ap_become_the_crisis
				or = {
					relative_power = {
						who = prev
						category = technology
						value > equivalent
					}
					relative_power = {
						who = prev
						category = economy
						value > equivalent
					}
					relative_power = {
						who = prev
						category = fleet
						value > equivalent
					}
				}
			}
		}
	}
}

### ap_detox
## Detox (Vanilla)
# Merge between SAP, WAP, and Ariphaos Unofficial Patch
# Base from SAP, modifiers from WAP, and AI improvements from Ariphaos
ap_detox = {
	potential = {
		host_has_dlc = "Toxoids Species Pack"
		NOT = {
			has_ascension_perk = ap_detox
		}
	}

	modifier = { # Worthy Ascension Perks modifiers
		planet_jobs_volatile_motes_produces_mult = 0.20
		planet_jobs_rare_crystals_produces_mult = 0.20
		planet_jobs_exotic_gases_produces_mult = 0.20
	}

	possible = {
		custom_tooltip = {
			fail_text = "requires_technology_tech_climate_restoration"
			has_technology = tech_climate_restoration
		}
	}

	on_enabled = {
		custom_tooltip = "detox_tox_worlds"
	}

	ai_weight = {
		factor = 20
		modifier = { # Ariphaos AI modifier
			factor = 0
			NOT = {
				any_planet_within_border = {
					has_modifier = toxic_terraforming_candidate
				}
			}
		}
		modifier = { # Ariphaos AI modifier
			factor = 3
			count_planet_within_border = {
				count > 2
				limit = { has_modifier = toxic_terraforming_candidate }
			}
		}
	}
}

### ap_engineered_evolution
## Engineered Evolution (Vanilla)
# Merge between SAP (Fusion), EMEX, Ariphaos
# Base from SAP (Fusion), potential changes to account for civics from EMEX (commented pending testing), and AI improvements from Ariphaos
ap_engineered_evolution = {
	on_enabled = {
		custom_tooltip = "engineered_evolution_tooltip"
		add_research_option = tech_gene_seed_purification
		if = {
			limit = {
				is_clone_army_empire = yes
				OR = {
					has_trait = trait_clone_soldier_infertile
					has_trait = trait_clone_soldier_infertile_full_potential
				}
			}
			custom_tooltip = clone_soldier_locked_genes
		}
		# Planetary Diversity
		if = {
			limit = {
				has_origin = origin_techno_world
				OR = {
					has_trait = trait_organic_fourschildren
					has_trait = trait_organic_fourschildren_2
				}
			}
			custom_tooltip = fourschildren_locked_genes
		}
		hidden_effect = {
			country_event = { id = utopia.2700 }
		}
	}
	possible = {
		custom_tooltip = {
			fail_text = "synthetic_empire_biological_ascension"
			NOT = { has_trait = trait_mechanical }
		}
		custom_tooltip = {
			fail_text = "requires_ascension_perks_1"
			num_ascension_perks > 0
		}
		custom_tooltip = {
			fail_text = "requires_technology_gene_tailoring"
			has_technology = tech_gene_tailoring
		}
 #		custom_tooltip = {
 #			fail_text = "requires_not_ap_the_flesh_is_weak"
 #			NOT = { has_ascension_perk = ap_the_flesh_is_weak }
 #		}
 #		custom_tooltip = {
 #			fail_text = "requires_not_ap_organo_machine_interfacing"
 #			NOT = { has_ascension_perk = ap_organo_machine_interfacing }
 #		}
 #		custom_tooltip = {
 #			fail_text = "requires_not_ap_mind_over_matter"
 #			NOT = { has_ascension_perk = ap_mind_over_matter }
 #		}
 #		custom_tooltip = {
 #			fail_text = "requires_not_ap_synthetic_evolution"
 #			NOT = { has_ascension_perk = ap_synthetic_evolution }
 #		}
	#Vanilla restriction
		#custom_tooltip = {
		#	fail_text = "requires_free_tradition_tree"
		#	num_tradition_categories < 7
		#}
		# Expanded Gestalts Forgotten Queens
		#custom_tooltip = {
		#	fail_text = "requires_not_ap_mind_meld"
		#	NOT = { has_ascension_perk = ap_mind_meld }
		#}
	}

	potential = {
		has_utopia = yes
		NOR = {
			has_ascension_perk = ap_engineered_evolution
			AND = {
				has_authority = "auth_machine_intelligence"
				NOT = { has_civic = civic_machine_assimilator }
			}
			# EMEX changes commented out pending testing
			#has_origin = origin_shroudwalker_apprentice
			#has_valid_civic = civic_hive_cyborgs # EMEX
			#has_valid_civic = civic_hive_manipulators_of_life # EMEX
		}
 #		is_mechanical_empire = no
 #		is_cyborg_empire = no
	}

	ai_weight = {
		factor = 15
		modifier = {
			factor = 0
			num_owned_planets < 4
		}
		modifier = {
			factor = 0.1
			num_ascension_perks < 3
		}
		modifier = {
			factor = 10
			has_authority = auth_hive_mind
		}
		modifier = { # Double check with Sartek to see if this is intended, and if so why.
			factor = 0
			OR = {
				has_origin = origin_shroudwalker_apprentice
				has_ascension_perk = ap_the_flesh_is_weak
				has_ascension_perk = ap_organo_machine_interfacing
				has_ascension_perk = ap_organo_machine_interfacing_assimilator
				has_ascension_perk = ap_mind_over_matter
				has_ascension_perk = ap_synthetic_evolution
				has_ascension_perk = ap_engineered_evolution
				has_ascension_perk = ap_synthetic_age
			}
		}
	}
}

### ap_enigmatic_engineering
## Enigmatic Engineering (Vanilla - Apocalypse)
# Merge between SAP, Utopian Dream
# Base from SAP, adjustments to modifiers from Utopian Dream
ap_enigmatic_engineering = {
	potential = {
		host_has_dlc = "Apocalypse"
		NOT = {
			has_ascension_perk = ap_enigmatic_engineering
		}
	}

	possible = {
		custom_tooltip = {
			fail_text = "requires_ascension_perks_1"
			num_ascension_perks > 0
		}
	}

	on_enabled = {
		custom_tooltip = "no_rev_engineering"
		if = {
			limit = {
				has_global_flag = gf_utopiandream_activated
				NOT = { has_technology = tech_mega_art }
				host_has_dlc = "Megacorp"
			}
			add_research_option = tech_mega_art
			add_tech_progress = { tech = tech_mega_art progress = 0.75 } # Utopian Dream progress
        }
	}

	modifier = {
		# Utopian Dream 3.8
		intel_encryption_add = 5 # Default is 2, buffed by SAP
		country_engineering_tech_research_speed = 0.1
		country_engineering_research_produces_mult = 0.1
		# Worthy Ascension Perks
		diplo_weight_technology_mult = 0.25
		# Vanilla
		#intel_encryption_add = 2
	}

	tradition_swap = {
		name = ap_enigmatic_engineering_cloaking
		inherit_effects = no
		inherit_icon = yes
		trigger = {
			has_first_contact_dlc = yes
		}

		on_enabled = {
			custom_tooltip = "no_rev_engineering"
			if = {
				limit = {
					has_global_flag = gf_utopiandream_activated
					NOT = { has_technology = tech_mega_art }
					host_has_dlc = "Megacorp"
				}
				add_research_option = tech_mega_art
				add_tech_progress = { tech = tech_mega_art progress = 0.75 } # Utopian Dream added progress
			}
		}

		modifier = {
			# Utopian Dream 3.8
			ship_cloaking_strength_add = 2
			intel_encryption_add = 5 # Default is 2, buffed by SAP
			country_engineering_tech_research_speed = 0.15
			country_engineering_research_produces_mult = 0.1
			# Worthy Ascension Perks
			diplo_weight_technology_mult = 0.25
			# Vanilla
			#ship_cloaking_strength_add = 2
			#intel_encryption_add = 2
		}

		weight = {
			factor = 1
		}
	}

	ai_weight = {
		factor = 2
		modifier = {
			factor = 10
			has_valid_civic = civic_inwards_perfection
		}
		# Vanilla
		#modifier = {
		#	factor = 2
		#	is_materialist = yes
		#	is_xenophobe = yes
		#}
		# Utopian Dream
		modifier = {
			factor = 0.1
			nor = {
				has_ethic = ethic_materialist
				has_ethic = ethic_xenophobe
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_materialist
				has_ethic = ethic_fanatic_militarist
				has_ethic = ethic_fanatic_xenophobe                        
			}
		}
		modifier = {
			factor = 1.1
			or = {
				has_ethic = ethic_materialist
				has_ethic = ethic_xenophobe
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_materialist
				has_ethic = ethic_fanatic_militarist
				has_ethic = ethic_fanatic_xenophobe                        
			}
		}
		modifier = {
			factor = 1.1
			has_ethic = ethic_materialist
		}
		modifier = {
			factor = 2
			has_ethic = ethic_xenophobe
		}
		modifier = {
			factor = 1.2
			has_ethic = ethic_militarist
		}
		modifier = {
			factor = 5
			or = {	
				has_ethic = ethic_fanatic_materialist
				has_ethic = ethic_fanatic_militarist
				has_ethic = ethic_fanatic_xenophobe
			}
		}
	}
}

### ap_eternal_vigilance
## Eternal Vigilance (Vanilla)
# Merge between SAP, Utopian Dream, UAP,
# Base from SAP, change possible condition from Utopian Dream, minor improvements from UAP, adjustment to AI weight from StarTech
ap_eternal_vigilance = {
	possible = {
		has_technology = tech_starbase_3 # Utopian Dream opens this up faster
		# Vanilla requirements
		#custom_tooltip = {
		#	fail_text = "requires_technology_starbase_4"
		#	has_technology = tech_starbase_4
		#}
	}

	on_enabled = { 
		# Unique Ascension Perks
		if = {
			limit = { has_global_flag = has_uap_mod }
			custom_tooltip = "ap_eternal_vigilance_tooltip"
			hidden_effect = {
				country_event = { id = UniqueAscensionPerksEvents.129 }
			}
		}
		# Gigaestructural Engineering
		if = {
			limit = { has_global_flag = gigastructures_enabled }
			custom_tooltip = "adds_4_asteroid_artillery_points"
			hidden_effect = {
				change_variable = {
					which = asteroid_artillery_points_max
					value = 4
				}
			}
		}
		# Utopian Dream
        if = {
            limit = {
                host_has_dlc = "Utopia"
				has_global_flag = gf_utopiandream_activated
                NOT = { has_technology = tech_sentry_array }
            }
            add_research_option = tech_sentry_array
            add_tech_progress = { tech = tech_sentry_array progress = 0.75 }
        }
	}
	
	modifier = {
		# Limitless Stellaris Merged Modifiers
		shipclass_starbase_damage_mult = 0.5	# Utopian Dream
		shipclass_starbase_hull_mult = 0.25		# Vanilla
		shipclass_military_station_damage_mult = 0.25	# Vanilla
		shipclass_military_station_hull_mult = 0.25		# Worthy Ascension Perks
        starbase_defense_platform_capacity_add = 5		# Vanilla
		starbase_defensive_war_ship_build_speed_mult = 0.25 # Worthy Ascension Perks
		ship_friendly_territory_fire_rate_mult = 0.25	# Utopian Dream
		ship_sensor_range_add = 1		# Utopian Dream
		army_defense_morale_mult = 1	# Utopian Dream
		# Vanilla
		#shipclass_starbase_damage_mult = 0.25
		#shipclass_starbase_hull_mult = 0.25
		#shipclass_military_station_damage_mult = 0.25
		#starbase_defense_platform_capacity_add = 5
	}

	potential = {
		NOT = { has_ascension_perk = ap_eternal_vigilance }
	}

	ai_weight = {
		# VANILLA
		# factor = 10
		# Unique Ascension Perks
		# factor = 15
		# StarTech AI (actually disables it... but it is re-enabled with a lower factor since it's buffed now)
		factor = 2
		modifier = {
			factor = 2
			has_civic = civic_inwards_perfection
		}
		modifier = {
			factor = 1.5
			is_xenophobe = yes
		}
		modifier = {
			factor = 1.5
			any_neighbor_country = {
				merg_is_default_empire = yes
				opinion_level = { who = root level <= poor }
				relative_power = { who = root value >= superior }
			}
		}
	}
}

### ap_executive_vigor
## Executive Vigor (Vanilla)
# Merge between SAP, Utopian Dream, WAP, StarTech, Ariphaos
# Base from SAP, add modifier from Utopian Dream, add modifier from WAP, adjust AI weight from StarTech and Ariphaos
ap_executive_vigor = {
	modifier = {
		#ESAP
		country_leader_cap_add = 1
		# Utopian Dream Modifiers
		country_edict_fund_add = 200
		# Worthy Ascension Perks Modifiers
		edicts_upkeep_mult = -0.20
		# Since V3.3 efect is now edict_fund_add
		# Added modifiers on_enabled instead
		#country_edict_fund_add = 100
	}

	potential = {
		NOT = {
			has_ethic = ethic_gestalt_consciousness
			has_ascension_perk = ap_executive_vigor
			has_ascension_perk = ap_esap_gov_1
		}
	}
	on_enabled = {
		# ESAP Merger Stack
		if = {
			limit = { has_global_flag = esap_mod_in_use }
			custom_tooltip = "ap_esap_gov_1_tooltip"
			hidden_effect = {
				if = {
					limit = {
						check_variable = { which = var_esap_goverment_perk_count value = 0 }
					}
					add_modifier = { modifier = "mod_esap_gov_1_1" days = -1 }
				}
				if = {
					limit = {
						check_variable = { which = var_esap_goverment_perk_count value = 1 }
					}
					add_modifier = { modifier = "mod_esap_gov_1_1" days = -1 }
				}
				if = {
					limit = {
						check_variable = { which = var_esap_goverment_perk_count value = 2 }
					}
					add_modifier = { modifier = "mod_esap_gov_1_2" days = -1 }
				}
				if = {
					limit = {
						check_variable = { which = var_esap_goverment_perk_count value = 3 }
					}
					add_modifier = { modifier = "mod_esap_gov_1_3" days = -1 }
				}
				if = {
					limit = {
						check_variable = { which = var_esap_goverment_perk_count value = 4 }
					}
					add_modifier = { modifier = "mod_esap_gov_1_4" days = -1 }
				}
				country_event = {
					id = esap_gov.1
				}
			}	
		}
		# Sartek Merger - Compatibility
		if = {
			limit = { NOT = { has_global_flag = esap_mod_in_use } }
			custom_tooltip = "sartek_executive_vigor_tooltip"
			hidden_effect = {
					add_modifier = { modifier = "mod_sartek_executive_vigor" days = -1 }
				}
		}
		# Unique Ascension Perks
		if = {
			limit = { has_global_flag = has_uap_mod }
			custom_tooltip = "ap_executive_vigor_tooltip"
			hidden_effect = {
				country_event = { id = UniqueAscensionPerksEvents.421 }
			}
		}
	}

	ai_weight = { # StarTech AI Weight
		factor = 300
		modifier = {
			factor = 20
			turtler2 = yes
		}
		modifier = {
			factor = 5
			turtler = yes
			num_ascension_perks < 3
		}
		modifier = {
			factor = 20
			resource_stockpile_compare = {
				resource = influence
				value > 250
			}
		}
		modifier = {
			factor = 100
			calc_true_if = {
				amount > 2
				is_authoritarian = yes
				is_pacifist = yes
				not = { has_authority = auth_imperial }
				has_technology = tech_mineral_purification_1
				has_technology = tech_food_processing_1
				has_technology = tech_power_hub_1
			}
		}
		modifier = {
			factor = 0
			has_origin = origin_void_dwellers
			NOT = {
				has_ascension_perk = ap_voidborn
			}
		}
		modifier = { # Ariphaos modifier
			factor = 2
			has_technology = tech_ascension_theory
		}
	}
}

##################################################
## Modded Ascension Perks
##################################################

### AAR_AP_navigator
## Great Navigator (Advanced Ascension Rework) gave 500% sublight speed.
# I can't remember why I originally disabled this. So I'm re-enabling it for testing purposes.
# AAR_AP_navigator = {
# 	potential = {
# 		always = no
# 	}
# 	possible = {
# 		always = no
# 	}

# 	on_enabled = {
# 		custom_tooltip = "AAR_tips_AP_navigator"
# 		hidden_effect = {
# 			add_modifier = { modifier = AAR_MOD_cntr_navigator days = -1 }
# 		}
# 	}

# 	modifier = {
# 		pc_habitat_habitability = 0.05	#иор╩╫вн╙0.2

# 		ship_windup_mult = -0.35
# 		ship_winddown_mult = -0.35
# 	#	ship_ftl_jumpdrive_range_mult = 0.15
# 		ship_jumpdrive_cooldown_mult = -0.05
		
# 		ship_disengage_chance_mult = 0.25
# 		ship_emergency_ftl_min_days_mult = -0.50
# 		ship_emergency_ftl_mult = -0.25
# 	}

# 	ai_weight = {
# 		factor = 35
# 		modifier = {
# 			factor = 1.2
# 			OR = {
# 				has_ethic = ethic_fanatic_pacifist
# 				has_origin = origin_void_dwellers
# 			}
# 		}
# 		modifier = {
# 			factor = 1.2
# 			count_owned_planet = {
# 				count > 2
# 				limit = {
# 					is_planet_class = pc_habitat
# 				}
# 			}
# 		}
# 	}
# }

## Ascension Star (Tidy Traditions)
# Disabled. Has no english language translation.
ap_tt_ascension_star = {
	potential = {
		always = no
	}
	possible = {
		always = no
	}
	on_enabled = {
		custom_tooltip = "find_ascension_star"
		hidden_effect = {
			if = {
				limit = { is_ai != yes }
				country_event = { id = TT_ascension_star.1 }
			}
			else_if = {
				limit = { is_ai = yes }
				add_modifier = { modifier = the_road_to_rejuvenation_ai days = -1 }
			}
		}
	}
	ai_weight = {
		factor = 15
	}
}

## Darkmatter Ripper (DarkSpace)
# Disabled. Bad mechanics.
ap_darkmatter_ripper = {
	potential = {
		always = no
	}
	possible = {
		always = no
	}
	on_enabled = { 
		add_research_option = tech_darkmatter_ripper
		country_event = { id = dsDMR.1 }
	}
	ai_weight = { factor = 0 }
}