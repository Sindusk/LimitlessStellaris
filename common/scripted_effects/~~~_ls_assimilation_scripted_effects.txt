##########################################################################
# Limitless Stellaris - Scripted Effects
##########################################################################

##################################################
## Mod Edits
##################################################

## Prepare Cyborg Species [Assimilate All the Pops!]
# Add Bug Branch conditionals based on ethic.
prepare_cyborg_species = {
	optimize_memory
	if = {
		limit = {
			exists = prev
			prev = {
				OR = {
					AND = {
						is_scope_type = country
						is_hive_empire = no
					}
					AND = {
						exists = owner
						owner = { is_hive_empire = no }
					}
				}
			}
		}
		modify_species = {
			species = this
			add_trait = trait_cybernetic
			add_traits_at_start_of_list = yes
			remove_trait = trait_self_modified
			remove_trait = trait_hive_mind
			remove_trait = trait_bugged_happy_hive # Bug Branch
			change_scoped_species = no
			effect = {
				set_assimilation_flags = yes
				save_event_target_as = prepared_species
			}
		}
	}
	else_if = {
		limit = { # Check for Bug Branch ethics
			prev = {
				NAND = {
					has_ethic = ethic_form_autonomous
					has_ethic = ethic_form_affective
				}
			}
		}
		modify_species = { # Normal cybernetic hive mind modification
			species = this
			add_trait = trait_cybernetic
			add_trait = trait_hive_mind
			add_traits_at_start_of_list = yes
			remove_trait = trait_self_modified
			remove_trait = trait_latent_psionic
			remove_trait = trait_psionic
			remove_trait = trait_bugged_happy_hive # Bug Branch
			change_scoped_species = no
			effect = {
				set_assimilation_flags = yes
				save_event_target_as = prepared_species
			}
		}
	}
	else =  {
		modify_species = { # Bug Branch - Happy Hive cybernetic hive mind modification
			species = this
			add_trait = trait_cybernetic
			add_trait = trait_bugged_happy_hive
			add_traits_at_start_of_list = yes
			remove_trait = trait_self_modified
			remove_trait = trait_latent_psionic
			remove_trait = trait_psionic
			remove_trait = trait_hive_mind
			change_scoped_species = no
			effect = {
				set_assimilation_flags = yes
				save_event_target_as = prepared_species
			}
		}
	}
}

## Prepare Hive Species [Assimilate All the Pops!]
# Merge in Bug Branch conditionals based on ethic.
prepare_hive_species = {
	optimize_memory
	if = {
		limit = { # Check for Bug Branch ethics
			prev = {
				NAND = {
					has_ethic = ethic_form_autonomous
					has_ethic = ethic_form_affective
				}
			}
		}
		modify_species = { # Normal modification
			species = this
			add_trait = trait_hive_mind
			remove_trait = trait_self_modified
			remove_trait = trait_latent_psionic
			remove_trait = trait_psionic
			change_scoped_species = no
			effect = { set_assimilation_flags = yes }
		}
	}
	else = {
		modify_species = { # Bug Branch - Happy Hive modification
			species = this
			add_trait = trait_bugged_happy_hive
			remove_trait = trait_self_modified
			remove_trait = trait_latent_psionic
			remove_trait = trait_psionic
			change_scoped_species = no
			effect = { set_assimilation_flags = yes }
		}
	}
}

## Prepare Unhive Species [Assimilate All the Pops!]
# Add Bug Branch trait to be removed.
prepare_unhive_species = {
	optimize_memory
	modify_species = {
		species = this
		remove_trait = trait_self_modified
		remove_trait = trait_hive_mind
		remove_trait = trait_bugged_happy_hive # Bug Branch
		change_scoped_species = no
		effect = { set_assimilation_flags = yes }
	}
}
